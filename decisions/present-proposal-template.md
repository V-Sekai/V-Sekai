# Draft: The Wandering Librarian - Prototype

## The Context

We need a way to test if LLMs can create engaging narratives in games. This prototype will serve as a testbed for exploring the potential of LLM-driven dynamic storytelling within a simplified game environment.

## The Problem Statement

Traditional game stories are often static and predictable, limiting player agency and immersion. LLMs offer the potential to generate dynamic narratives that react to player choices and create emergent gameplay experiences.

## Describe how your proposal will work with code, pseudo-code, mock-ups, or diagrams

The Minimal Viable Product (MVP) will focus on a single core gameplay loop centered around a traveling librarian who visits a new procedurally generated village each day. The player interacts with villagers, learns their needs and desires, and provides them with books to fulfill those needs.

**Core Gameplay Loop:**

1. **Arrive in Village:**

    - The LLM generates a village with a simple map and a few key locations (e.g., town square, tavern, character homes).

    ```python
    # Pseudo-code for village generation
    def generate_village():
         village = {}
         village['name'] = LLM.generate_village_name()
         village['map'] = LLM.generate_map_layout()
         village['locations'] = LLM.generate_locations(3)  # Generate 3 locations
         village['characters'] = LLM.generate_characters(3) # Generate 3 characters
         return village
    ```

2. **Explore and Interact:**

    - The player explores the village and interacts with characters through dialogue.
    - Dialogue is dynamically generated by the LLM based on character backstories and player choices.

    ```python
    # Pseudo-code for dialogue interaction
    def talk_to_character(character_id):
         initial_dialogue = LLM.generate_initial_dialogue(character_id)
         display(initial_dialogue)
         player_response = get_player_input()
         while not end_conversation:
              response = LLM.generate_response(character_id, player_response)
              display(response)
              player_response = get_player_input()
    ```

3. **Fulfill Needs with Books:**
    - The player selects books from their inventory or purchases new ones to match character preferences.
    - The LLM generates character needs and desires related to reading (e.g., favorite genres, desired knowledge).
    ```python
    # Pseudo-code for fulfilling needs
    def give_book(character_id, book_title):
         character_reaction = LLM.generate_reaction(character_id, book_title)
         if character_reaction['satisfied']:
              update_character_state(character_id, 'satisfied')
              # Trigger potential story events or quests
         display(character_reaction['dialogue'])
    ```

**LLM Integration:**

- **World Generation:** Creates unique villages, maps, and locations.
- **Character Development:** Generates characters with backstories, desires, and reading preferences.
- **Dynamic Dialogue:** Handles conversations, reacting to player choices and gifted books.
- **Catalog Generation:** Creates a dynamic catalog of books with varying prices and rarities.

**Content Verification:**

- A verifier monitors LLM output to ensure coherence, filter inappropriate content, and maintain consistency.

**Goal-Task Planner Integration:**

- **Define predicates:** The core predicates for this domain are:
  - `at(item, location)`: Specifies the location of an item (book or character).
  - `has(character, item)`: Indicates a character possesses a specific item.
  - `satisfied(character)`: Denotes whether a character's need is met.
- **Define operators:** The actions in the game map to operators:
  - `select_book(book)`: Adds a book to the player's inventory.
  - `talk_to(character)`: Initiates dialogue with a character.
  - `give_book(character, book)`: Transfers a book to the character.
- **Define methods:** Methods determine how to achieve goals:
  - `satisfy_character(character)`: A method to fulfill a character's need (using `give_book` if the player has the correct book).
- **State representation:** The game state is a dictionary:
  - `state.at`: Tracks locations of books and characters.
  - `state.has`: Tracks possession of books.
  - `state.satisfied`: Tracks character satisfaction.

**Example Goal:**

Instead of `character_satisfied`, a goal would be `satisfied(character_id)`.

Example in GTPyhop style:

```python
# ... (previous code) ...

# Define the method
def satisfy_character(state, character_id):
     if /* condition to check if player has the right book for the character */:
          return [('give_book', character_id, book_title)]
     else:
          return False

gtpyhop.declare_unigoal_methods('satisfied', satisfy_character)

# ... (rest of the code) ...
```

**Key changes:**

- Goals are now predicate-subject-object triples.
- Actions are defined as operators.
- Methods are used to decompose goals into actions.
- The state is explicitly represented as a dictionary.

By adhering to this structure, the prototype will effectively leverage the Goal-Task Planner for dynamic storytelling within the Wandering Librarian concept.

## The Benefits

- **Rapid Iteration:** The simplified scope allows for quick testing and refinement of LLM-driven narratives.
- **Dynamic Storytelling:** Creates emergent narratives and unpredictable gameplay experiences.
- **Exploration of LLM Capabilities:** Provides valuable insights into using LLMs for interactive storytelling.

## The Downsides

- **Limited Scope:** The prototype focuses on a narrow aspect of gameplay.
- **LLM Unpredictability:** Requires careful monitoring and content filtering to ensure quality and consistency.

## The Road Not Taken

- Developing a full-fledged game with complex mechanics would be too time-consuming for initial exploration.

## The Infrequent Use Case

- While the core loop is designed for daily interaction, players may occasionally skip days or play less frequently. The LLM will need to handle these infrequent interactions seamlessly, potentially by adjusting the narrative or providing catch-up mechanisms.

## Why is it in Core and done by us?

This project aligns with our core focus on innovative game development and exploring the use of LLMs in interactive narratives. It requires deep integration with our existing technology and understanding of our long-term goals.

## Status

Status: Draft

## Decision Makers

- V-Sekai development team

## Tags

- V-Sekai
- LLM
- Prototype
- Procedural Generation
- Dynamic Narrative
- Books
- Librarian

## Further Reading

1. [V-Sekai Â· GitHub](https://github.com/v-sekai) - Official GitHub account for the V-Sekai development community focusing on social VR functionality for the Godot Engine.
2. [V-Sekai/v-sekai-game](https://github.com/v-sekai/v-sekai-game) is the GitHub page for the V-Sekai open-source project, which brings social VR/VRSNS/metaverse components to the Godot Engine.

AI assistant Aria assisted with this article.
