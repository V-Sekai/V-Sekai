<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>V-Sekai</title>
<link>https://v-sekai.github.io/decisions.html</link>
<atom:link href="https://v-sekai.github.io/decisions.xml" rel="self" type="application/rss+xml"/>
<description></description>
<generator>quarto-1.2.269</generator>
<lastBuildDate>Wed, 30 Nov 2022 17:52:44 GMT</lastBuildDate>
<item>
  <title></title>
  <link>https://v-sekai.github.io/decisions/20221022-have-larger-worlds-by-server-state-migration.html</link>
  <description><![CDATA[ 



<section id="simulate-larger-3d-multiplayer-worlds-using-brickworlds-partition-layout" class="level1">
<h1>Simulate larger 3d multiplayer worlds using “brickworlds partition layout”</h1>
<ul>
<li>Status: draft <!-- draft | proposed | rejected | accepted | deprecated | superseded by --></li>
<li>Deciders: V-Sekai,Fire,Groak,</li>
<li>Tags: V-Sekai,</li>
</ul>
<section id="context-and-problem-statement" class="level2">
<h2 class="anchored" data-anchor-id="context-and-problem-statement">Context and Problem Statement</h2>
<p>Each V-Sekai game server has a scalability limit. Transfer each player to a different server when needed.</p>
<!-- Describe the problem or limitation you are having in your project. You may want to articulate the problem in the form of a question. -->
</section>
<section id="describe-the-proposed-option-and-how-it-helps-to-overcome-the-problem-or-limitation" class="level2">
<h2 class="anchored" data-anchor-id="describe-the-proposed-option-and-how-it-helps-to-overcome-the-problem-or-limitation">Describe the proposed option and how it helps to overcome the problem or limitation</h2>
<p>Transfer the state using a database that can handle commits in commit order despite parallel transactions.</p>
<p>Foundationdb is used by Apple for their cloud services and is trusted to handle distributed data safely.</p>
<p>Godot Engine is a game engine where the interiors are easy to rearrange.</p>
<p>Sqlite is a well written database that is fully tested.</p>
<p>Rust is a good language for failures in math or computer language, but does not handle non code errors (like cosmic rays) through language based software redundancy like Erlang.</p>
<p>Mvsqlite merges sqlite with Foundationdb with Rust glue.</p>
</section>
<section id="describe-how-your-proposal-will-work-with-code-pseudo-code-mock-ups-or-diagrams" class="level2">
<h2 class="anchored" data-anchor-id="describe-how-your-proposal-will-work-with-code-pseudo-code-mock-ups-or-diagrams">Describe how your proposal will work, with code, pseudo-code, mock-ups, or diagrams</h2>
<ol type="1">
<li>Partition the world into tiles via Prasetya, Kusno’s design.</li>
</ol>
<p><img src="https://v-sekai.github.io/decisions/attachments/20221022_uniform_partitioning.png" alt="20221022_uniform_partitioning by Prasetya, Kusno" width="50%"></p>
<ol start="2" type="1">
<li>Define the tiles with a premigration and migration border.</li>
</ol>
<p>Premigration and migration border via Prasetya, Kusno’s design.</p>
<p><img src="https://v-sekai.github.io/decisions/attachments/20221022_world_parition_pre_migration_and_migration_costs.png" alt="20221022_world_parition_pre_migration_and_migration_costs by Prasetya, Kusno" width="50%"></p>
<ol start="3" type="1">
<li>Transfer the player from one server to another by first syncing all the frames, and have the player connect to the other side. Then the server does the transfer and the player disconnects from the previous side when the migration boundary is hit.</li>
</ol>
<p>Server state transfer.</p>
<p><img src="https://v-sekai.github.io/decisions/attachments/20221022_server_state_transfer_load.png" alt="20221022_server_state_transfer_load" width="50%"></p>
<p>Sql schema based on Tigerbeetle.</p>
<p><img src="https://v-sekai.github.io/decisions/attachments/20221022_mvsqlite_sql_query.png" alt="20221022_server_state_transfer_load" width="50%"></p>
<ol start="4" type="1">
<li>Test using a multiplayer simulator via Prasetya, Kusno’s design</li>
</ol>
<p><img src="https://v-sekai.github.io/decisions/attachments/20221022_multiplayer_sim_variables.png" alt="20221022_multiplayer_sim_variables by Prasetya, Kusno" width="25%"></p>
</section>
<section id="positive-consequences" class="level2">
<h2 class="anchored" data-anchor-id="positive-consequences">Positive Consequences <!-- improvement of quality attribute satisfaction, follow-up decisions required --></h2>
<ul>
<li>Allows player transfer from one server to the others servers.</li>
</ul>
</section>
<section id="negative-consequences" class="level2">
<h2 class="anchored" data-anchor-id="negative-consequences">Negative Consequences <!-- compromising quality attribute, follow-up decisions required --></h2>
<ul>
<li>Needs to connect the servers to the foundation database simulation servers.</li>
</ul>
</section>
<section id="option-graveyard" class="level2">
<h2 class="anchored" data-anchor-id="option-graveyard">Option graveyard:</h2>
<ul>
<li>Option: The status quo. <!-- List the proposed options no longer open for consideration. --></li>
<li>Rejection Reason: This solves nothing. <!-- List the reasons for the rejection: (the bad traits) --></li>
</ul>
</section>
<section id="if-this-enhancement-will-not-be-used-often-can-it-be-worked-around-with-a-few-lines-of-script" class="level2">
<h2 class="anchored" data-anchor-id="if-this-enhancement-will-not-be-used-often-can-it-be-worked-around-with-a-few-lines-of-script">If this enhancement will not be used often, can it be worked around with a few lines of script?</h2>
<p>It’s not a few lines of script.</p>
</section>
<section id="is-there-a-reason-why-this-should-be-core-and-done-by-us" class="level2">
<h2 class="anchored" data-anchor-id="is-there-a-reason-why-this-should-be-core-and-done-by-us">Is there a reason why this should be core and done by us?</h2>
<p>We maintain the networking stack.</p>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References</h2>
<ul>
<li><a href="https://v-sekai.org/">V-Sekai</a></li>
<li><a href="https://pure.bond.edu.au/ws/portalfiles/portal/18275482/Efficient_Methods_for_Improving_Scalability_and_Playability_of_Massively_Multiplayer_Online_Game_MMOG_.pdf">Efficient_Methods_for_Improving_Scalability_and_Playability_of_Massively_Multiplayer_Online_Game_MMOG by Prasetya, Kusno</a></li>
<li><a href="https://github.com/V-Sekai/godot-sqlite/tree/mvsqlite">godot sqlite mvsqlite</a></li>
<li><a href="https://github.com/V-Sekai/godot-sqlite/tree/mvsqlite/demo">godot mvsql demo</a></li>
<li><a href="https://github.com/fire/mvsqlite/tree/windows">mvsqlite for windows</a></li>
<li><a href="https://github.com/losfair/mvsqlite">mvsqlite</a></li>
<li><a href="https://github.com/apple/foundationdb">Apple’s foundationdb</a></li>
<li><a href="https://www.rust-lang.org/">Rust lang</a></li>
<li><a href="https://github.com/tigerbeetledb/tigerbeetle">Special thanks to the TigerBeetle for the sql schema</a></li>
</ul>
</section>
<section id="code-references" class="level2">
<h2 class="anchored" data-anchor-id="code-references">Code References</h2>
<section id="create-entity-table" class="level3">
<h3 class="anchored" data-anchor-id="create-entity-table">Create entity table</h3>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode swift code-with-copy"><code class="sourceCode swift"><span id="cb1-1">extends Node3D</span>
<span id="cb1-2"></span>
<span id="cb1-3"><span class="kw" style="color: #003B4F;">func</span> <span class="fu" style="color: #4758AB;">_ready</span><span class="op" style="color: #5E5E5E;">():</span></span>
<span id="cb1-4">    <span class="dt" style="color: #AD0000;">var</span> <span class="fu" style="color: #4758AB;">db</span> <span class="op" style="color: #5E5E5E;">:</span> <span class="dt" style="color: #AD0000;">SQLite</span> <span class="op" style="color: #5E5E5E;">=</span> SQLite<span class="op" style="color: #5E5E5E;">.</span>new<span class="op" style="color: #5E5E5E;">();</span></span>
<span id="cb1-5">    <span class="cf" style="color: #003B4F;">if</span> <span class="op" style="color: #5E5E5E;">(!</span>db<span class="op" style="color: #5E5E5E;">.</span>open<span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"test"</span><span class="op" style="color: #5E5E5E;">)):</span></span>
<span id="cb1-6">        print<span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"Failed opening database."</span><span class="op" style="color: #5E5E5E;">);</span></span>
<span id="cb1-7">        <span class="kw" style="color: #003B4F;">return</span><span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb1-8">    <span class="kw" style="color: #003B4F;">var</span> <span class="va" style="color: #111111;">_drop</span> <span class="op" style="color: #5E5E5E;">:</span> String <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"""drop table if exists entity;</span></span>
<span id="cb1-9"><span class="st" style="color: #20794D;">"""</span></span>
<span id="cb1-10">    <span class="kw" style="color: #003B4F;">var</span> <span class="va" style="color: #111111;">_create_entity_table</span> <span class="op" style="color: #5E5E5E;">:</span> String <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"""</span></span>
<span id="cb1-11"><span class="st" style="color: #20794D;">CREATE TABLE entity (</span></span>
<span id="cb1-12"><span class="st" style="color: #20794D;">    id TEXT PRIMARY KEY NOT NULL CHECK(LENGTH(id) = 36),</span></span>
<span id="cb1-13"><span class="st" style="color: #20794D;">    user_data blob NOT NULL CHECK( LENGTH(user_data) = 16) DEFAULT (zeroblob(16)),</span></span>
<span id="cb1-14"><span class="st" style="color: #20794D;">    reserved blob NOT NULL CHECK( LENGTH(reserved) = 48)  DEFAULT (zeroblob(48)),</span></span>
<span id="cb1-15"><span class="st" style="color: #20794D;">    shard   INTEGER NOT NULL,</span></span>
<span id="cb1-16"><span class="st" style="color: #20794D;">    code    INTEGER NOT NULL,</span></span>
<span id="cb1-17"><span class="st" style="color: #20794D;">    flags   INTEGER NOT NULL,</span></span>
<span id="cb1-18"><span class="st" style="color: #20794D;">    past_pending    BLOB NOT NULL CHECK( LENGTH(past_pending) &lt;= 1024) DEFAULT (zeroblob(64)),</span></span>
<span id="cb1-19"><span class="st" style="color: #20794D;">    past_posted BLOB NOT NULL CHECK( LENGTH(past_posted) &lt;= 1024) DEFAULT (zeroblob(64)),</span></span>
<span id="cb1-20"><span class="st" style="color: #20794D;">    current_pending BLOB NOT NULL CHECK( LENGTH(current_pending) &lt;= 1024) DEFAULT (zeroblob(64)),</span></span>
<span id="cb1-21"><span class="st" style="color: #20794D;">    current_posted  BLOB NOT NULL CHECK( LENGTH(current_posted) &lt;= 1024) DEFAULT (zeroblob(64)),</span></span>
<span id="cb1-22"><span class="st" style="color: #20794D;">    timestamp INTEGER NOT NULL</span></span>
<span id="cb1-23"><span class="st" style="color: #20794D;">) WITHOUT ROWID, STRICT;</span></span>
<span id="cb1-24"><span class="st" style="color: #20794D;">"""</span></span>
<span id="cb1-25">#   db<span class="op" style="color: #5E5E5E;">.</span>query<span class="op" style="color: #5E5E5E;">(</span>create_entity_table<span class="op" style="color: #5E5E5E;">)</span></span>
<span id="cb1-26">    <span class="kw" style="color: #003B4F;">var</span> <span class="va" style="color: #111111;">_truncate_entities</span> <span class="op" style="color: #5E5E5E;">:</span> String <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"""</span></span>
<span id="cb1-27"><span class="st" style="color: #20794D;">DELETE FROM entity;</span></span>
<span id="cb1-28"><span class="st" style="color: #20794D;">    """</span></span>
<span id="cb1-29">#   db<span class="op" style="color: #5E5E5E;">.</span>query<span class="op" style="color: #5E5E5E;">(</span>truncate_entities<span class="op" style="color: #5E5E5E;">)</span></span>
<span id="cb1-30">    <span class="cf" style="color: #003B4F;">for</span> i <span class="cf" style="color: #003B4F;">in</span> range<span class="op" style="color: #5E5E5E;">(</span><span class="dv" style="color: #AD0000;">32</span><span class="op" style="color: #5E5E5E;">):</span></span>
<span id="cb1-31">        <span class="kw" style="color: #003B4F;">var</span> <span class="va" style="color: #111111;">node_3d</span> <span class="op" style="color: #5E5E5E;">:</span> Node3D <span class="op" style="color: #5E5E5E;">=</span> Node3D<span class="op" style="color: #5E5E5E;">.</span>new<span class="op" style="color: #5E5E5E;">()</span></span>
<span id="cb1-32">        <span class="kw" style="color: #003B4F;">var</span> <span class="va" style="color: #111111;">script</span> <span class="op" style="color: #5E5E5E;">=</span> load<span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"res://sqlite_write/sqlite_write_scene.gd"</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span id="cb1-33">        node_3d<span class="op" style="color: #5E5E5E;">.</span>set_script<span class="op" style="color: #5E5E5E;">(</span>script<span class="op" style="color: #5E5E5E;">)</span></span>
<span id="cb1-34">        add_child<span class="op" style="color: #5E5E5E;">(</span>node_3d<span class="op" style="color: #5E5E5E;">,</span> <span class="kw" style="color: #003B4F;">true</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span id="cb1-35">        node_3d<span class="op" style="color: #5E5E5E;">.</span>owner <span class="op" style="color: #5E5E5E;">=</span> <span class="kw" style="color: #003B4F;">self</span></span></code></pre></div>
</section>
<section id="simulate-entity-processing" class="level3">
<h3 class="anchored" data-anchor-id="simulate-entity-processing">Simulate entity processing</h3>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode swift code-with-copy"><code class="sourceCode swift"><span id="cb2-1">extends Node3D</span>
<span id="cb2-2"></span>
<span id="cb2-3"><span class="kw" style="color: #003B4F;">var</span> <span class="va" style="color: #111111;">db</span> <span class="op" style="color: #5E5E5E;">:</span> SQLite <span class="op" style="color: #5E5E5E;">=</span> null</span>
<span id="cb2-4"><span class="kw" style="color: #003B4F;">var</span> <span class="va" style="color: #111111;">result_create</span> <span class="op" style="color: #5E5E5E;">:</span> SQLiteQuery</span>
<span id="cb2-5"><span class="kw" style="color: #003B4F;">var</span> <span class="va" style="color: #111111;">result_delete</span> <span class="op" style="color: #5E5E5E;">:</span> SQLiteQuery</span>
<span id="cb2-6"><span class="kw" style="color: #003B4F;">var</span> <span class="va" style="color: #111111;">uuid</span> <span class="op" style="color: #5E5E5E;">:</span> String</span>
<span id="cb2-7"></span>
<span id="cb2-8"><span class="kw" style="color: #003B4F;">func</span> <span class="fu" style="color: #4758AB;">_ready</span><span class="op" style="color: #5E5E5E;">():</span></span>
<span id="cb2-9">    <span class="dt" style="color: #AD0000;">db</span> <span class="op" style="color: #5E5E5E;">=</span> SQLite<span class="op" style="color: #5E5E5E;">.</span>new<span class="op" style="color: #5E5E5E;">();</span></span>
<span id="cb2-10">    <span class="cf" style="color: #003B4F;">if</span> <span class="op" style="color: #5E5E5E;">(!</span>db<span class="op" style="color: #5E5E5E;">.</span>open<span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"test"</span><span class="op" style="color: #5E5E5E;">)):</span></span>
<span id="cb2-11">        print<span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"Failed opening database."</span><span class="op" style="color: #5E5E5E;">);</span></span>
<span id="cb2-12">        <span class="kw" style="color: #003B4F;">return</span><span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb2-13"></span>
<span id="cb2-14">    <span class="kw" style="color: #003B4F;">var</span> <span class="va" style="color: #111111;">select_uuid</span> <span class="op" style="color: #5E5E5E;">:</span> String <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"""</span></span>
<span id="cb2-15"><span class="st" style="color: #20794D;">    SELECT lower(hex(randomblob(4)) || '-' || hex(randomblob(2)) || '-' || '4' ||</span></span>
<span id="cb2-16"><span class="st" style="color: #20794D;">    substr(hex( randomblob(2)), 2) || '-' ||</span></span>
<span id="cb2-17"><span class="st" style="color: #20794D;">    substr('AB89', 1 + (abs(random()) % 4) , 1)  ||</span></span>
<span id="cb2-18"><span class="st" style="color: #20794D;">    substr(hex(randomblob(2)), 2) || '-' ||</span></span>
<span id="cb2-19"><span class="st" style="color: #20794D;">    hex(randomblob(6))) as uuid;</span></span>
<span id="cb2-20"><span class="st" style="color: #20794D;">    """</span></span>
<span id="cb2-21">    uuid <span class="op" style="color: #5E5E5E;">=</span> db<span class="op" style="color: #5E5E5E;">.</span>fetch_array<span class="op" style="color: #5E5E5E;">(</span>select_uuid<span class="op" style="color: #5E5E5E;">)[</span><span class="dv" style="color: #AD0000;">0</span><span class="op" style="color: #5E5E5E;">][</span><span class="st" style="color: #20794D;">"uuid"</span><span class="op" style="color: #5E5E5E;">]</span></span>
<span id="cb2-22">    <span class="kw" style="color: #003B4F;">var</span> <span class="va" style="color: #111111;">query_create_original</span> <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"""</span></span>
<span id="cb2-23"><span class="st" style="color: #20794D;">INSERT INTO entity ("id", "user_data", "reserved", "shard", "code", "flags", "past_pending", "past_posted",</span></span>
<span id="cb2-24"><span class="st" style="color: #20794D;">"current_pending", "current_posted", "timestamp")</span></span>
<span id="cb2-25"><span class="st" style="color: #20794D;">VALUES (?, zeroblob(16), zeroblob(48), 0, 0, 0, zeroblob(64), zeroblob(64), zeroblob(64), ?, UNIXEPOCH());</span></span>
<span id="cb2-26"><span class="st" style="color: #20794D;">"""</span></span>
<span id="cb2-27">    result_create <span class="op" style="color: #5E5E5E;">=</span> db<span class="op" style="color: #5E5E5E;">.</span>create_query<span class="op" style="color: #5E5E5E;">(</span>query_create_original<span class="op" style="color: #5E5E5E;">)</span></span>
<span id="cb2-28">    <span class="kw" style="color: #003B4F;">var</span> <span class="va" style="color: #111111;">query_delete</span> <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"""</span></span>
<span id="cb2-29"><span class="st" style="color: #20794D;">    DELETE FROM entity</span></span>
<span id="cb2-30"><span class="st" style="color: #20794D;">    WHERE id = ?;</span></span>
<span id="cb2-31"><span class="st" style="color: #20794D;">"""</span></span>
<span id="cb2-32">    result_delete <span class="op" style="color: #5E5E5E;">=</span> db<span class="op" style="color: #5E5E5E;">.</span>create_query<span class="op" style="color: #5E5E5E;">(</span>query_delete<span class="op" style="color: #5E5E5E;">)</span></span>
<span id="cb2-33"></span>
<span id="cb2-34"><span class="kw" style="color: #003B4F;">func</span> <span class="fu" style="color: #4758AB;">_process</span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">_delta</span><span class="op" style="color: #5E5E5E;">):</span></span>
<span id="cb2-35">    <span class="dt" style="color: #AD0000;">if</span> <span class="fu" style="color: #4758AB;">db</span> <span class="op" style="color: #5E5E5E;">==</span> null<span class="op" style="color: #5E5E5E;">:</span></span>
<span id="cb2-36">        <span class="kw" style="color: #003B4F;">return</span></span>
<span id="cb2-37">    <span class="kw" style="color: #003B4F;">var</span> <span class="va" style="color: #111111;">packed_array</span> <span class="op" style="color: #5E5E5E;">:</span> Array <span class="op" style="color: #5E5E5E;">=</span> Array<span class="op" style="color: #5E5E5E;">()</span></span>
<span id="cb2-38">    packed_array<span class="op" style="color: #5E5E5E;">.</span>push_back<span class="op" style="color: #5E5E5E;">(</span>global_transform<span class="op" style="color: #5E5E5E;">)</span></span>
<span id="cb2-39">    <span class="kw" style="color: #003B4F;">var</span> <span class="va" style="color: #111111;">bytes</span> <span class="op" style="color: #5E5E5E;">:</span> PackedByteArray <span class="op" style="color: #5E5E5E;">=</span> var_to_bytes<span class="op" style="color: #5E5E5E;">(</span>packed_array<span class="op" style="color: #5E5E5E;">)</span></span>
<span id="cb2-40">    bytes <span class="op" style="color: #5E5E5E;">=</span> bytes<span class="op" style="color: #5E5E5E;">.</span>compress<span class="op" style="color: #5E5E5E;">(</span>FileAccess<span class="op" style="color: #5E5E5E;">.</span>COMPRESSION_ZSTD<span class="op" style="color: #5E5E5E;">)</span></span>
<span id="cb2-41">    <span class="kw" style="color: #003B4F;">var</span> <span class="va" style="color: #111111;">statement</span> <span class="op" style="color: #5E5E5E;">:</span> Array <span class="op" style="color: #5E5E5E;">=</span> <span class="op" style="color: #5E5E5E;">[</span>uuid<span class="op" style="color: #5E5E5E;">,</span> bytes<span class="op" style="color: #5E5E5E;">]</span></span>
<span id="cb2-42">    <span class="kw" style="color: #003B4F;">var</span> <span class="va" style="color: #111111;">_result_batch</span> <span class="op" style="color: #5E5E5E;">=</span> result_create<span class="op" style="color: #5E5E5E;">.</span>batch_execute<span class="op" style="color: #5E5E5E;">([</span>statement<span class="op" style="color: #5E5E5E;">])</span></span>
<span id="cb2-43"></span>
<span id="cb2-44"><span class="kw" style="color: #003B4F;">func</span> <span class="fu" style="color: #4758AB;">_exit_tree</span><span class="op" style="color: #5E5E5E;">():</span></span>
<span id="cb2-45">    <span class="dt" style="color: #AD0000;">var</span> <span class="fu" style="color: #4758AB;">statement</span> <span class="op" style="color: #5E5E5E;">:</span> <span class="dt" style="color: #AD0000;">Array</span> <span class="op" style="color: #5E5E5E;">=</span> <span class="op" style="color: #5E5E5E;">[</span>uuid<span class="op" style="color: #5E5E5E;">]</span></span>
<span id="cb2-46">    <span class="kw" style="color: #003B4F;">var</span> <span class="va" style="color: #111111;">_result_batch</span> <span class="op" style="color: #5E5E5E;">=</span> result_delete<span class="op" style="color: #5E5E5E;">.</span>batch_execute<span class="op" style="color: #5E5E5E;">([</span>statement<span class="op" style="color: #5E5E5E;">])</span></span></code></pre></div>
</section>
</section>
<section id="mvsqlite-for-windows" class="level2">
<h2 class="anchored" data-anchor-id="mvsqlite-for-windows">mvsqlite for Windows</h2>
<pre class="bat"><code>cmd
scoop install llvm openssl-mingw llvm-mingw
cargo build --release -p mvsqlite
cd mvsqlite-sqlite3
mingw32-make.exe build-patched-sqlite3
set RUST_LOG=info
set MVSQLITE_DATA_PLANE=http://localhost:7000
sqlite3 test
.tables</code></pre>
<section id="check-fdb-status" class="level3">
<h3 class="anchored" data-anchor-id="check-fdb-status">Check fdb status</h3>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><span class="ex" style="color: null;">fdbcli</span></span>
<span id="cb4-2"><span class="ex" style="color: null;">status</span></span>
<span id="cb4-3"><span class="co" style="color: #5E5E5E;"># Force create a database</span></span>
<span id="cb4-4"><span class="co" style="color: #5E5E5E;"># configure new single memory</span></span></code></pre></div>
</section>
<section id="create-a-mvsqlite-database" class="level3">
<h3 class="anchored" data-anchor-id="create-a-mvsqlite-database">Create a mvsqlite database</h3>
<pre class="bat"><code>msys2
curl http://localhost:7001/api/create_namespace -i -d '{"key":"test"}'</code></pre>
</section>
<section id="starting-mvstore-with-foundationdb-on-linux" class="level3">
<h3 class="anchored" data-anchor-id="starting-mvstore-with-foundationdb-on-linux">Starting mvstore with foundationdb on Linux</h3>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><span class="co" style="color: #5E5E5E;"># on Linux</span></span>
<span id="cb6-2"><span class="fu" style="color: #4758AB;">wget</span> https://github.com/apple/foundationdb/releases/download/7.1.15/foundationdb-clients_7.1.15-1_amd64.deb</span>
<span id="cb6-3"><span class="fu" style="color: #4758AB;">sudo</span> dpkg <span class="at" style="color: #657422;">-i</span> foundationdb-clients_7.1.15-1_amd64.deb</span>
<span id="cb6-4"><span class="fu" style="color: #4758AB;">wget</span> https://github.com/apple/foundationdb/releases/download/7.1.15/foundationdb-server_7.1.15-1_amd64.deb</span>
<span id="cb6-5"><span class="fu" style="color: #4758AB;">sudo</span> dpkg <span class="at" style="color: #657422;">-i</span> foundationdb-server_7.1.15-1_amd64.deb</span>
<span id="cb6-6"><span class="ex" style="color: null;">cargo</span> build <span class="at" style="color: #657422;">--release</span> <span class="at" style="color: #657422;">-p</span> mvstore</span>
<span id="cb6-7"><span class="va" style="color: #111111;">RUST_LOG</span><span class="op" style="color: #5E5E5E;">=</span>info <span class="ex" style="color: null;">./mvstore</span> <span class="dt" style="color: #AD0000;">\</span></span>
<span id="cb6-8">  <span class="at" style="color: #657422;">--data-plane</span> 127.0.0.1:7000 <span class="dt" style="color: #AD0000;">\</span></span>
<span id="cb6-9">  <span class="at" style="color: #657422;">--admin-api</span> 127.0.0.1:7001 <span class="dt" style="color: #AD0000;">\</span></span>
<span id="cb6-10">  <span class="at" style="color: #657422;">--metadata-prefix</span> mvstore <span class="dt" style="color: #AD0000;">\</span></span>
<span id="cb6-11">  <span class="at" style="color: #657422;">--raw-data-prefix</span> m</span></code></pre></div>
</section>
<section id="starting-mvstore-with-foundationdb-on-windows" class="level3">
<h3 class="anchored" data-anchor-id="starting-mvstore-with-foundationdb-on-windows">Starting mvstore with foundationdb on Windows</h3>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><span class="ex" style="color: null;">cmd</span></span>
<span id="cb7-2"><span class="ex" style="color: null;">cargo</span> build <span class="at" style="color: #657422;">--release</span> <span class="at" style="color: #657422;">-p</span> mvstore</span>
<span id="cb7-3"><span class="bu" style="color: null;">set</span> RUST_LOG=info</span>
<span id="cb7-4"><span class="ex" style="color: null;">mvstore</span> <span class="at" style="color: #657422;">--data-plane</span> 127.0.0.1:7000 <span class="at" style="color: #657422;">--admin-api</span> 127.0.0.1:7001 <span class="at" style="color: #657422;">--metadata-prefix</span> mvstore <span class="at" style="color: #657422;">--raw-data-prefix</span> m <span class="at" style="color: #657422;">--cluster</span> <span class="st" style="color: #20794D;">"C:/ProgramData/foundationdb/fdb.cluster"</span></span></code></pre></div>
</section>
</section>
<section id="launch-scripts" class="level2">
<h2 class="anchored" data-anchor-id="launch-scripts">Launch scripts</h2>
<section id="start-sqlite3.bat" class="level3">
<h3 class="anchored" data-anchor-id="start-sqlite3.bat">start-sqlite3.bat</h3>
<pre class="bat"><code>set RUST_LOG=info
set MVSQLITE_DATA_PLANE=http://localhost:7000
sqlite3 test</code></pre>
</section>
<section id="start-mvstore.bat" class="level3">
<h3 class="anchored" data-anchor-id="start-mvstore.bat">start-mvstore.bat</h3>
<pre class="bat"><code>set RUST_LOG=error
mvstore --data-plane 127.0.0.1:7000 --admin-api 127.0.0.1:7001 --metadata-prefix mvstore --raw-data-prefix m --cluster "C:/ProgramData/foundationdb/fdb.cluster"</code></pre>
</section>
</section>
<section id="license-of-the-contribution" class="level2">
<h2 class="anchored" data-anchor-id="license-of-the-contribution">License of the contribution</h2>
<p>Copyright (c) 2022 V-Sekai contributors.</p>
<p>Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the “Software”), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:</p>
<p>The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.</p>
<p>THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p>


</section>
</section>

 ]]></description>
  <guid>https://v-sekai.github.io/decisions/20221022-have-larger-worlds-by-server-state-migration.html</guid>
  <pubDate>Wed, 30 Nov 2022 17:52:44 GMT</pubDate>
</item>
<item>
  <title></title>
  <link>https://v-sekai.github.io/decisions/20221021-make-it-easier-propose-and-post-bugs.html</link>
  <description><![CDATA[ 



<section id="make-it-easier-to-propose-and-file-bugs-by-simplifying-the-templates" class="level1">
<h1>Make it easier to propose and file bugs by simplifying the templates</h1>
<ul>
<li>Status: proposed <!-- draft | proposed | rejected | accepted | deprecated | superseded by --></li>
<li>Deciders: V-Sekai,lyuma</li>
<li>Tags: V-Sekai,</li>
</ul>
<section id="context-and-problem-statement" class="level2">
<h2 class="anchored" data-anchor-id="context-and-problem-statement">Context and Problem Statement</h2>
<p>About issue templates, I know Godot doesn’t permit plain feature requests in the main godot issue tracker. To propose something you have to have a fleshed out proposal.</p>
<p>That works well for Godot for two reasons: Godot has lots of users so there are already too many feature proposals; and the users of Godot are developers who can be asked to do research and write a whole implementation proposal</p>
<p>The users of V-Sekai are not technical in the same way; and furthermore we are not at the scale Godot was in 3.2 when they switched to requiring proposals.</p>
<p>If we ever do get big enough that feature requests propose a burden then we can consider making it harder to file them</p>
</section>
<section id="describe-the-proposed-option-and-how-it-helps-to-overcome-the-problem-or-limitation" class="level2">
<h2 class="anchored" data-anchor-id="describe-the-proposed-option-and-how-it-helps-to-overcome-the-problem-or-limitation">Describe the proposed option and how it helps to overcome the problem or limitation</h2>
<p>Modify the V-Sekai-game issue templates to be easier to use.</p>
</section>
<section id="describe-how-your-proposal-will-work-with-code-pseudo-code-mock-ups-or-diagrams" class="level2">
<h2 class="anchored" data-anchor-id="describe-how-your-proposal-will-work-with-code-pseudo-code-mock-ups-or-diagrams">Describe how your proposal will work, with code, pseudo-code, mock-ups, or diagrams</h2>
<p>Remove required fields. Make them easier to use.</p>
</section>
<section id="positive-consequences" class="level2">
<h2 class="anchored" data-anchor-id="positive-consequences">Positive Consequences <!-- improvement of quality attribute satisfaction, follow-up decisions required --></h2>
<ul>
<li>More bug filing</li>
<li>More proposals</li>
</ul>
</section>
<section id="negative-consequences" class="level2">
<h2 class="anchored" data-anchor-id="negative-consequences">Negative Consequences <!-- compromising quality attribute, follow-up decisions required --></h2>
<ul>
<li>More work on the devs to catalog</li>
</ul>
</section>
<section id="option-graveyard" class="level2">
<h2 class="anchored" data-anchor-id="option-graveyard">Option graveyard:</h2>
<ul>
<li>Option: The status quo. <!-- List the proposed options no longer open for consideration. --></li>
<li>Rejection Reason: This solves nothing. <!-- List the reasons for the rejection: (the bad traits) --></li>
</ul>
</section>
<section id="if-this-enhancement-will-not-be-used-often-can-it-be-worked-around-with-a-few-lines-of-script" class="level2">
<h2 class="anchored" data-anchor-id="if-this-enhancement-will-not-be-used-often-can-it-be-worked-around-with-a-few-lines-of-script">If this enhancement will not be used often, can it be worked around with a few lines of script?</h2>
<p>Not a script.</p>
</section>
<section id="is-there-a-reason-why-this-should-be-core-and-done-by-us" class="level2">
<h2 class="anchored" data-anchor-id="is-there-a-reason-why-this-should-be-core-and-done-by-us">Is there a reason why this should be core and done by us?</h2>
<p>We own the repos.</p>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References</h2>
<ul>
<li><a href="https://v-sekai.org/">V-Sekai</a></li>
</ul>
</section>
<section id="license-of-the-contribution" class="level2">
<h2 class="anchored" data-anchor-id="license-of-the-contribution">License of the contribution</h2>
<p>Copyright (c) 2022 V-Sekai contributors.</p>
<p>Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the “Software”), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:</p>
<p>The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.</p>
<p>THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p>


</section>
</section>

 ]]></description>
  <guid>https://v-sekai.github.io/decisions/20221021-make-it-easier-propose-and-post-bugs.html</guid>
  <pubDate>Wed, 30 Nov 2022 17:52:44 GMT</pubDate>
</item>
<item>
  <title></title>
  <link>https://v-sekai.github.io/decisions/20221019-replicate-sync-100-000-entities.html</link>
  <description><![CDATA[ 



<section id="replicate-sync-100000-entities-using-a-solution-revision-1" class="level1">
<h1>Replicate sync 100’000 entities using a solution (Revision 1)</h1>
<ul>
<li>Status: proposed</li>
<li>Deciders: V-Sekai,fire,</li>
<li>Tags: V-Sekai,sync,view replication,</li>
</ul>
<section id="context-and-problem-statement" class="level2">
<h2 class="anchored" data-anchor-id="context-and-problem-statement">Context and Problem Statement</h2>
<p>Develop a performant and robust (correctly and with liveness) network entity sync in V-Sekai.</p>
<p>A client is one Godot Engine connection, it can view and change entities.</p>
<p>There are 100’000 networked entities in a city and we go from position a to position b in a loop in a mover with one or more attached cabins.</p>
</section>
<section id="describe-the-proposed-option-and-how-it-helps-to-overcome-the-problem-or-limitation" class="level2">
<h2 class="anchored" data-anchor-id="describe-the-proposed-option-and-how-it-helps-to-overcome-the-problem-or-limitation">Describe the proposed option and how it helps to overcome the problem or limitation</h2>
<p>This document is a general problem statement.</p>
</section>
<section id="positive-consequences" class="level2">
<h2 class="anchored" data-anchor-id="positive-consequences">Positive Consequences <!-- optional --></h2>
<ul>
<li>Large sims!</li>
</ul>
</section>
<section id="negative-consequences" class="level2">
<h2 class="anchored" data-anchor-id="negative-consequences">Negative Consequences <!-- optional --></h2>
</section>
<section id="option-graveyard" class="level2">
<h2 class="anchored" data-anchor-id="option-graveyard">Option graveyard: <!-- same as above --></h2>
<ul>
<li>Option: Current V-Sekai replication</li>
<li>Rejection Reason: Can’t link servers</li>
</ul>
</section>
<section id="if-this-enhancement-will-not-be-used-often-can-it-be-worked-around-with-a-few-lines-of-script" class="level2">
<h2 class="anchored" data-anchor-id="if-this-enhancement-will-not-be-used-often-can-it-be-worked-around-with-a-few-lines-of-script">If this enhancement will not be used often, can it be worked around with a few lines of script?</h2>
<p>Entity replication is not trivial.</p>
</section>
<section id="is-there-a-reason-why-this-should-be-core-and-done-by-us" class="level2">
<h2 class="anchored" data-anchor-id="is-there-a-reason-why-this-should-be-core-and-done-by-us">Is there a reason why this should be core and done by us?</h2>
<p>We’re doing the networking layer.</p>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References <!-- optional and numbers of links can vary --></h2>
<ul>
<li><a href="../decisions/20221019-develop-a-replication-sync-for-100-000-entities.html">20221019-develop-a-replication-sync-for-100-000-entities.md</a></li>
<li><a href="../decisions/20221016-v-sekai-view-replication.html">20221016-v-sekai-view-replication.md</a></li>
<li><a href="../decisions/20221014-networking-overhaul-proposal.html">20221014-networking-overhaul-proposal.md</a></li>
<li><a href="https://pure.bond.edu.au/ws/portalfiles/portal/18275482/Efficient_Methods_for_Improving_Scalability_and_Playability_of_Massively_Multiplayer_Online_Game_MMOG_.pdf">Efficient_Methods_for_Improving_Scalability_and_Playability_of_Massively_Multiplayer_Online_Game_MMOG_.pdf</a></li>
</ul>
<section id="questions" class="level3">
<h3 class="anchored" data-anchor-id="questions">Questions</h3>
<p>How many clients can be in this simulation?</p>
<p>The state database should be smaller to avoid replication traffic on non-liveliness.</p>
</section>
</section>
<section id="math" class="level2">
<h2 class="anchored" data-anchor-id="math">Math</h2>
<p>The calculation of who to pair and to find nearby or relevant players is a N^2 loop. Use better algorithms to lower O (N^2) into O (N log N).</p>
<p>The proposed solution can be solved in O (N log N).</p>
</section>
<section id="derivative-license" class="level2">
<h2 class="anchored" data-anchor-id="derivative-license">Derivative License</h2>
<p>Copyright (c) 2022 V-Sekai contributors.</p>
<p>Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the “Software”), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:</p>
<p>The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.</p>
<p>THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p>


</section>
</section>

 ]]></description>
  <guid>https://v-sekai.github.io/decisions/20221019-replicate-sync-100-000-entities.html</guid>
  <pubDate>Wed, 30 Nov 2022 17:52:44 GMT</pubDate>
</item>
<item>
  <title></title>
  <link>https://v-sekai.github.io/decisions/20221019-networking-100000-entities-ownership.html</link>
  <description><![CDATA[ 



<section id="networking-with-100000-entities-and-ownership-revision-2" class="level1">
<h1>Networking with 100000 Entities and Ownership (Revision 2)</h1>
<ul>
<li>Status: proposed <!-- draft | proposed | rejected | accepted | deprecated | superseded by --></li>
<li>Deciders: V-Sekai,</li>
<li>Tags: V-Sekai, Networking</li>
</ul>
<section id="context-and-problem-statement" class="level2">
<h2 class="anchored" data-anchor-id="context-and-problem-statement">Context and Problem Statement</h2>
<p>In short, replication of state while permitting object ownership to transfer, at scale.</p>
</section>
<section id="describe-the-proposed-option-and-how-it-helps-to-overcome-the-problem-or-limitation" class="level2">
<h2 class="anchored" data-anchor-id="describe-the-proposed-option-and-how-it-helps-to-overcome-the-problem-or-limitation">Describe the proposed option and how it helps to overcome the problem or limitation</h2>
<p>If we go with a model in which objects have one of three policies:</p>
<ol type="1">
<li>Deny</li>
<li>Ask Master</li>
<li>Allow always (synchronous replication)</li>
</ol>
<p>We want to ensure various guarantees in each case.</p>
<ol type="1">
<li>There is no problem</li>
<li>We will delay sync by 1 round trip, so there is no problem because everything is synchronized against the master.</li>
<li>We will follow a “last-write wins” strategy from the perspective of the relay server responsible for mastership.</li>
</ol>
<p>Other relays only need to know which server owns each object (and possibly the ownership / mastership table), and where each entity is.</p>
<p>Having this constraint permits us to use a model where we do not need consistent and transactional global information about object ownership, which allows the system to be simpler.</p>
<p>Idea of separation of presence queries (who is here, reliably, tricky to figure out who of 100000 clients is relevant?) from realtime networking sync, which can flow directly from relay to relay, degrading over distance.</p>
</section>
<section id="describe-how-your-proposal-will-work-with-code-pseudo-code-mock-ups-or-diagrams" class="level2">
<h2 class="anchored" data-anchor-id="describe-how-your-proposal-will-work-with-code-pseudo-code-mock-ups-or-diagrams">Describe how your proposal will work, with code, pseudo-code, mock-ups, or diagrams</h2>
<p>None yet. We may try prototyping this type of system in multiple ways.</p>
</section>
<section id="positive-consequences" class="level2">
<h2 class="anchored" data-anchor-id="positive-consequences">Positive Consequences <!-- improvement of quality attribute satisfaction, follow-up decisions required --></h2>
<p>This keeps low latency but reduces the needed bandwidth to sync 100,000 entites.</p>
<p>Napkin math:</p>
<pre><code>50 bytes per frame per object * 100,000 objects = 5MB per frame.
5MB/frame * 20 fps = 100MB = 1Gbps
If we send updates of all obejcts to all objects, that requires 100Tb/s

&gt; yea 100k users at once is impossible any way you put it. I think a realistic goal is 1k, as like, our max goal

Right, so you would need to not send updates for far away objects

Only send 1000 closest objects: 1Tb/s 

+ Send faraway objects at 2Hz: 100Gb/s

+ Heavy delta compression: 10Gb/s

This is for all players

Thie means, in a hypothetical universe where distant objects only need position sync, a server with 10Gb/s NIC could theoretically run 100,000 concurrent users, if optimizzed!

Also, therefore, per player bandwidth **of distant objects** would be 100Kbit/s of downstream data, which is pretty small.

Again I haven't accounted for IK synchronization, or for additional nearby objects, so it could be higher here.
Nearby objects is a smaller problem and easier to solve, and belongs in a separate proposal.</code></pre>
</section>
<section id="negative-consequences" class="level2">
<h2 class="anchored" data-anchor-id="negative-consequences">Negative Consequences <!-- compromising quality attribute, follow-up decisions required --></h2>
<p>We may be overcomplicating a problem that doesn’t need to be solved yet. Pure interest management may be sufficient, and we do not currently have this many users.</p>
</section>
<section id="option-graveyard" class="level2">
<h2 class="anchored" data-anchor-id="option-graveyard">Option graveyard:</h2>
</section>
<section id="if-this-enhancement-will-not-be-used-often-can-it-be-worked-around-with-a-few-lines-of-script" class="level2">
<h2 class="anchored" data-anchor-id="if-this-enhancement-will-not-be-used-often-can-it-be-worked-around-with-a-few-lines-of-script">If this enhancement will not be used often, can it be worked around with a few lines of script?</h2>
</section>
<section id="is-there-a-reason-why-this-should-be-core-and-done-by-us" class="level2">
<h2 class="anchored" data-anchor-id="is-there-a-reason-why-this-should-be-core-and-done-by-us">Is there a reason why this should be core and done by us?</h2>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References</h2>
<p>Source:</p>
<p>Discord VC with Malek and iFire</p>
<p>Discord channel forum-v-sekai “Networking with librg” thread: https://discord.com/channels/471446618156040210/1031379649776848900/1032401929587929208</p>
</section>
<section id="license-of-the-contribution" class="level2">
<h2 class="anchored" data-anchor-id="license-of-the-contribution">License of the contribution</h2>
<p>Copyright (c) 2022 V-Sekai contributors.</p>
<p>Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the “Software”), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:</p>
<p>The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.</p>
<p>THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p>


</section>
</section>

 ]]></description>
  <guid>https://v-sekai.github.io/decisions/20221019-networking-100000-entities-ownership.html</guid>
  <pubDate>Wed, 30 Nov 2022 17:52:44 GMT</pubDate>
</item>
<item>
  <title></title>
  <link>https://v-sekai.github.io/decisions/20221019-develop-a-replication-sync-for-100-000-entities.html</link>
  <description><![CDATA[ 



<section id="replicate-sync-100000-entities-using-godot-engine-mvsqlite-and-foundationdb" class="level1">
<h1>Replicate sync 100’000 entities using Godot Engine, mvsqlite and Foundationdb</h1>
<ul>
<li>Status: proposed</li>
<li>Deciders: V-Sekai,fire,</li>
<li>Tags: V-Sekai,sync,view replication,</li>
</ul>
<section id="context-and-problem-statement" class="level2">
<h2 class="anchored" data-anchor-id="context-and-problem-statement">Context and Problem Statement</h2>
<p>See <a href="../decisions/20221019-replicate-sync-100-000-entities.html">replicate sync 100’000 entities using a solution</a>.</p>
</section>
<section id="describe-the-proposed-option-and-how-it-helps-to-overcome-the-problem-or-limitation" class="level2">
<h2 class="anchored" data-anchor-id="describe-the-proposed-option-and-how-it-helps-to-overcome-the-problem-or-limitation">Describe the proposed option and how it helps to overcome the problem or limitation</h2>
<p>I propose we have groups of servers handling entities. Each server is synchronized with mvsqlite.</p>
</section>
<section id="describe-how-your-proposal-will-work-with-code-pseudo-code-mock-ups-or-diagrams" class="level2">
<h2 class="anchored" data-anchor-id="describe-how-your-proposal-will-work-with-code-pseudo-code-mock-ups-or-diagrams">Describe how your proposal will work, with code, pseudo-code, mock-ups, or diagrams</h2>
<p>We assume we’re using Godot Engine 4 with float is doubles.</p>
<p>The servers do not share (independently access) the same memory or storage.</p>
<p>We can track the entity’s visibility and have a packed byte array per frame.</p>
<p>Use mvsqlite in STRICT sql mode.</p>
<p>Use the SQLite generated columns option STORED to optimize for reading and VIRTUAL to optimize for writing.</p>
<p>Create ECS style mvsqlite database for streaming and events (movement, health, avatar path and others).</p>
<p>For movement update the table once and only once per frame.</p>
<p>For avatar paths that change batch notify once per frame.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://v-sekai.github.io/decisions/https:/user-images.githubusercontent.com/32321/196743240-092dba67-98e7-4a92-937c-48dd26284d4f.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">image</figcaption><p></p>
</figure>
</div>
</section>
<section id="positive-consequences" class="level2">
<h2 class="anchored" data-anchor-id="positive-consequences">Positive Consequences <!-- optional --></h2>
<ul>
<li>The code is using foundationdb’s share nothing architecture.</li>
</ul>
</section>
<section id="negative-consequences" class="level2">
<h2 class="anchored" data-anchor-id="negative-consequences">Negative Consequences <!-- optional --></h2>
<ul>
<li>Worried that latency will be above 20 milliseconds. It was shown in the graphs. May be a bug in mvsqlite with sequential key retries. Does the ownership / mastership of entities change often?</li>
</ul>
</section>
<section id="option-graveyard" class="level2">
<h2 class="anchored" data-anchor-id="option-graveyard">Option graveyard: <!-- same as above --></h2>
<ul>
<li>Option: Current V-Sekai replication</li>
<li>Rejection Reason: Can’t link servers</li>
</ul>
</section>
<section id="if-this-enhancement-will-not-be-used-often-can-it-be-worked-around-with-a-few-lines-of-script" class="level2">
<h2 class="anchored" data-anchor-id="if-this-enhancement-will-not-be-used-often-can-it-be-worked-around-with-a-few-lines-of-script">If this enhancement will not be used often, can it be worked around with a few lines of script?</h2>
<p>Entity replication is not trivial.</p>
</section>
<section id="is-there-a-reason-why-this-should-be-core-and-done-by-us" class="level2">
<h2 class="anchored" data-anchor-id="is-there-a-reason-why-this-should-be-core-and-done-by-us">Is there a reason why this should be core and done by us?</h2>
<p>We’re doing the networking layer.</p>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References <!-- optional and numbers of links can vary --></h2>
<ul>
<li><a href="https://apple.github.io/foundationdb/fault-tolerance.html">fault-tolerance</a></li>
<li><a href="https://github.com/V-Sekai/godot-sqlite/tree/mvsqlite">godot-sqlite with mvsqlite</a></li>
<li><a href="https://github.com/novuscore/NovusCore">novus core</a></li>
</ul>
</section>
<section id="diagram-source" class="level2">
<h2 class="anchored" data-anchor-id="diagram-source">Diagram source</h2>
<pre class="nomnoml"><code>[godot client alice] -&gt; [godot server alpha with mvsqlite |  [godot server alpha with mvsqlite| owns groups entities per tick
  | have a way to track entities
  | create, update and delete entity groups]]
[godot client bob] -&gt; [godot server beta with mvsqlite |  [godot server beta with mvsqlite| owns groups entities per tick
  | have a way to track entities
  | create, update and delete entity groups]]
[godot client carol] -&gt; [godot server gamma with mvsqlite |  [godot server gamma with mvsqlite| owns groups entities per tick
  | have a way to track entities
  | create, update and delete entity groups]]
  [godot server alpha with mvsqlite] - [godot server beta with mvsqlite]
  [godot server alpha with mvsqlite] - [godot server gamma with mvsqlite]
  [godot server beta with mvsqlite] - [godot server gamma with mvsqlite]</code></pre>
</section>
<section id="derivative-license" class="level2">
<h2 class="anchored" data-anchor-id="derivative-license">Derivative License</h2>
<p>Copyright (c) 2022 V-Sekai contributors.</p>
<p>Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the “Software”), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:</p>
<p>The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.</p>
<p>THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p>


</section>
</section>

 ]]></description>
  <guid>https://v-sekai.github.io/decisions/20221019-develop-a-replication-sync-for-100-000-entities.html</guid>
  <pubDate>Wed, 30 Nov 2022 17:52:44 GMT</pubDate>
  <media:content url="https://user-images.githubusercontent.com/32321/196743240-092dba67-98e7-4a92-937c-48dd26284d4f.png" medium="image" type="image/png"/>
</item>
<item>
  <title></title>
  <link>https://v-sekai.github.io/decisions/20221018-v-sekai-game-update-procedure.html</link>
  <description><![CDATA[ 



<section id="to-remember-how-to-update-the-engine-and-game-write-a-procedure" class="level1">
<h1>To remember how to update the engine and game write a procedure</h1>
<ul>
<li>Status: proposed <!-- draft | proposed | rejected | accepted | deprecated | superseded by --></li>
<li>Deciders: V-Sekai,</li>
<li>Tags: V-Sekai,</li>
</ul>
<section id="context-and-problem-statement" class="level2">
<h2 class="anchored" data-anchor-id="context-and-problem-statement">Context and Problem Statement</h2>
<!-- Describe the problem or limitation you are having in your project. You may want to articulate the problem in the form of a question. -->
<p>Godot Engine and V-Sekai are fast moving projects.</p>
</section>
<section id="describe-the-proposed-option-and-how-it-helps-to-overcome-the-problem-or-limitation" class="level2">
<h2 class="anchored" data-anchor-id="describe-the-proposed-option-and-how-it-helps-to-overcome-the-problem-or-limitation">Describe the proposed option and how it helps to overcome the problem or limitation</h2>
<p>Write down how to update the engine and the game.</p>
</section>
<section id="describe-how-your-proposal-will-work-with-code-pseudo-code-mock-ups-or-diagrams" class="level2">
<h2 class="anchored" data-anchor-id="describe-how-your-proposal-will-work-with-code-pseudo-code-mock-ups-or-diagrams">Describe how your proposal will work, with code, pseudo-code, mock-ups, or diagrams</h2>
<ol type="1">
<li>First step: change the <code>update_vsekai_godot</code> script to push to a staging branch.</li>
<li>Next step (lazy and simple): it is your responsibility to build the engine, run groups project and make sure it works.</li>
<li>Optionally: you should perform an export build and make sure that works too.</li>
<li>Next step (less lazy): we add another set of CI pipelines for staging godot -&gt; staging templates -&gt; staging groups and then we test that</li>
<li>Most issues aren’t export related, so I think engine build + open project and run project is probably sufficient for most things and we need a script to push staging -&gt; groups-4.x</li>
<li>Which means everyone gets the upgraded engine</li>
</ol>
</section>
<section id="positive-consequences" class="level2">
<h2 class="anchored" data-anchor-id="positive-consequences">Positive Consequences <!-- improvement of quality attribute satisfaction, follow-up decisions required --></h2>
<p>Creating a standard procedure means people know what to do.</p>
</section>
<section id="negative-consequences" class="level2">
<h2 class="anchored" data-anchor-id="negative-consequences">Negative Consequences <!-- compromising quality attribute, follow-up decisions required --></h2>
<p>It’s complicated.</p>
</section>
<section id="option-graveyard" class="level2">
<h2 class="anchored" data-anchor-id="option-graveyard">Option graveyard:</h2>
<ul>
<li>Option: The status quo. <!-- List the proposed options no longer open for consideration. --></li>
<li>Rejection Reason: This solves nothing. <!-- List the reasons for the rejection: (the bad traits) --></li>
</ul>
</section>
<section id="if-this-enhancement-will-not-be-used-often-can-it-be-worked-around-with-a-few-lines-of-script" class="level2">
<h2 class="anchored" data-anchor-id="if-this-enhancement-will-not-be-used-often-can-it-be-worked-around-with-a-few-lines-of-script">If this enhancement will not be used often, can it be worked around with a few lines of script?</h2>
<p>This is a procedure and not code.</p>
</section>
<section id="is-there-a-reason-why-this-should-be-core-and-done-by-us" class="level2">
<h2 class="anchored" data-anchor-id="is-there-a-reason-why-this-should-be-core-and-done-by-us">Is there a reason why this should be core and done by us?</h2>
<p>We know how to do this and others don’t.</p>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References</h2>
<ul>
<li><a href="https://v-sekai.org/">V-Sekai</a></li>
</ul>
</section>
<section id="license-of-the-contribution" class="level2">
<h2 class="anchored" data-anchor-id="license-of-the-contribution">License of the contribution</h2>
<p>Copyright (c) 2022 V-Sekai contributors.</p>
<p>Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the “Software”), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:</p>
<p>The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.</p>
<p>THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p>


</section>
</section>

 ]]></description>
  <guid>https://v-sekai.github.io/decisions/20221018-v-sekai-game-update-procedure.html</guid>
  <pubDate>Wed, 30 Nov 2022 17:52:44 GMT</pubDate>
</item>
<item>
  <title></title>
  <link>https://v-sekai.github.io/decisions/20221017-template.html</link>
  <description><![CDATA[ 



<section id="short-title-that-solves-problem-with-solution" class="level1">
<h1>Short title that solves problem with solution</h1>
<ul>
<li>Status: proposed <!-- draft | proposed | rejected | accepted | deprecated | superseded by --></li>
<li>Deciders: V-Sekai,</li>
<li>Tags: V-Sekai,</li>
</ul>
<section id="context-and-problem-statement" class="level2">
<h2 class="anchored" data-anchor-id="context-and-problem-statement">Context and Problem Statement</h2>
<!-- Describe the problem or limitation you are having in your project. You may want to articulate the problem in the form of a question. -->
</section>
<section id="describe-the-proposed-option-and-how-it-helps-to-overcome-the-problem-or-limitation" class="level2">
<h2 class="anchored" data-anchor-id="describe-the-proposed-option-and-how-it-helps-to-overcome-the-problem-or-limitation">Describe the proposed option and how it helps to overcome the problem or limitation</h2>
</section>
<section id="describe-how-your-proposal-will-work-with-code-pseudo-code-mock-ups-or-diagrams" class="level2">
<h2 class="anchored" data-anchor-id="describe-how-your-proposal-will-work-with-code-pseudo-code-mock-ups-or-diagrams">Describe how your proposal will work, with code, pseudo-code, mock-ups, or diagrams</h2>
</section>
<section id="positive-consequences" class="level2">
<h2 class="anchored" data-anchor-id="positive-consequences">Positive Consequences <!-- improvement of quality attribute satisfaction, follow-up decisions required --></h2>
</section>
<section id="negative-consequences" class="level2">
<h2 class="anchored" data-anchor-id="negative-consequences">Negative Consequences <!-- compromising quality attribute, follow-up decisions required --></h2>
</section>
<section id="option-graveyard" class="level2">
<h2 class="anchored" data-anchor-id="option-graveyard">Option graveyard:</h2>
<ul>
<li>Option: The status quo. <!-- List the proposed options no longer open for consideration. --></li>
<li>Rejection Reason: This solves nothing. <!-- List the reasons for the rejection: (the bad traits) --></li>
</ul>
</section>
<section id="if-this-enhancement-will-not-be-used-often-can-it-be-worked-around-with-a-few-lines-of-script" class="level2">
<h2 class="anchored" data-anchor-id="if-this-enhancement-will-not-be-used-often-can-it-be-worked-around-with-a-few-lines-of-script">If this enhancement will not be used often, can it be worked around with a few lines of script?</h2>
</section>
<section id="is-there-a-reason-why-this-should-be-core-and-done-by-us" class="level2">
<h2 class="anchored" data-anchor-id="is-there-a-reason-why-this-should-be-core-and-done-by-us">Is there a reason why this should be core and done by us?</h2>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References</h2>
<ul>
<li><a href="https://v-sekai.org/">V-Sekai</a></li>
</ul>
</section>
<section id="license-of-the-contribution" class="level2">
<h2 class="anchored" data-anchor-id="license-of-the-contribution">License of the contribution</h2>
<p>Copyright (c) 2022 V-Sekai contributors.</p>
<p>Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the “Software”), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:</p>
<p>The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.</p>
<p>THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p>


</section>
</section>

 ]]></description>
  <guid>https://v-sekai.github.io/decisions/20221017-template.html</guid>
  <pubDate>Wed, 30 Nov 2022 17:52:44 GMT</pubDate>
</item>
<item>
  <title></title>
  <link>https://v-sekai.github.io/decisions/20221016-v-sekai-view-replication.html</link>
  <description><![CDATA[ 



<section id="use-view-replication-algorithm-for-multiplayer-multirelay-sync" class="level1">
<h1>Use view replication algorithm for multiplayer multirelay sync</h1>
<ul>
<li>Status: rejected</li>
<li>Deciders: V-Sekai,fire,</li>
<li>Tags: V-Sekai,sync,view replication,</li>
</ul>
<section id="context-and-problem-statement" class="level2">
<h2 class="anchored" data-anchor-id="context-and-problem-statement">Context and Problem Statement</h2>
<p>See <a href="../decisions/20221019-replicate-sync-100-000-entities.html">replicate sync 100’000 entities using a solution</a>.</p>
</section>
<section id="describe-the-proposed-option-and-how-it-helps-to-overcome-the-problem-or-limitation" class="level2">
<h2 class="anchored" data-anchor-id="describe-the-proposed-option-and-how-it-helps-to-overcome-the-problem-or-limitation">Describe the proposed option and how it helps to overcome the problem or limitation</h2>
<p>V-Sekai could use viewstamp replication in the context of game entity interpolation of past and current state.</p>
<p>The key insight is everything is a keyframed animation that is nearest, linear or cubic interpolated.</p>
</section>
<section id="describe-how-your-proposal-will-work-with-code-pseudo-code-mock-ups-or-diagrams" class="level2">
<h2 class="anchored" data-anchor-id="describe-how-your-proposal-will-work-with-code-pseudo-code-mock-ups-or-diagrams">Describe how your proposal will work, with code, pseudo-code, mock-ups, or diagrams</h2>
<p>We assume we’re using Godot Engine 4 with float is doubles.</p>
<ol type="1">
<li>Replicate pending property changes safely to a quorum of distributed replicas, then</li>
<li>interpolate property changes to the in-memory state.
<ul>
<li>Ignore p_time too far in the future or the past as the viewstamp limit.</li>
<li>T Animation::_interpolate(const Vector&lt;TKey&lt;T&gt;&gt; &amp;p_keys, double p_time, InterpolationType p_interp, bool p_loop_wrap, bool *p_ok, bool p_backward) const</li>
</ul></li>
<li>ACK to the client.</li>
</ol>
<p>See also Linux io_uring (replacement for epoll).</p>
<p>Everything is an interpolation event or a property state. Want to fit datastructures into 128 bytes (2 CPU cache lines).</p>
<p>We reuse the create_property data structure as the state.</p>
<section id="work-in-progress-data-structure-based-on-tigerbeetle" class="level4">
<h4 class="anchored" data-anchor-id="work-in-progress-data-structure-based-on-tigerbeetle">Work in progress data structure based on Tigerbeetle</h4>
<p>Referencing https://github.com/tigerbeetledb/tigerbeetle/blob/main/docs/DESIGN.md#data-structures.</p>
<p>See <code>Variant bytes_to_var_with_objects (PackedByteArray bytes)</code> and <code>PackedByteArray var_to_bytes_with_objects (Variant variable)</code>.</p>
<section id="create_property_interpolate" class="level5">
<h5 class="anchored" data-anchor-id="create_property_interpolate">create_property_interpolate</h5>
<pre class="zig"><code>create_property_interpolate {
           id: 16 bytes (128-bit)
   past_entity_id: 16 bytes (128-bit)
current_entity_id: 16 bytes (128-bit) [to allow interpolation between different entities]
    user_data: 16 bytes (128-bit) [optional, e.g. opaque third-party identifier to link 
        this transfer (many-to-one) to an external entity]
     reserved: 16 bytes (128-bit) [reserved, for accounting policy primitives]
       pending_id: 16 bytes (128-bit) [optional, required to post or void an existing but pending transfer]
      timeout:  8 bytes (64-bit) [optional, required only for a pending transfer, a quantity of time, 
        i.e. an offset in nanoseconds from timestamp]
        shard:  4 bytes (32-bit) [required, to enforce isolation by ensuring that all transfers 
        are between entities of the same shard]
         code:  2 bytes (16-bit) [required, an opaque entity code describing the type 
        of the interpolation, e.g. player, map, prop]
        flags:  2 bytes (16-bit) [optional, to modify the usage of the reserved field and for future feature expansion.]
        value:  n bytes (n-bit) [required, variant of the past property and current property, 
        which must be the same for both properties. Uses var_to_bytes_with_objects.]
    timestamp:  8 bytes (64-bit) [reserved, assigned by the leader before journalling]
} = n bytes (n CPU cache lines)</code></pre>
</section>
<section id="create_property" class="level5">
<h5 class="anchored" data-anchor-id="create_property">create_property</h5>
<pre class="zig"><code>   create_property {
          id: 16 bytes (128-bit)
       user_data: 16 bytes (128-bit) [optional, opaque third-party identifier to link this account 
        (many-to-one) to an external entity]
    reserved: 48 bytes (384-bit) [reserved for future accounting policy primitives]
       shard:  4 bytes (32-bit) [required, to enforce isolation by ensuring that all transfers 
        are between accounts of the same ledger]
        code:  2 bytes (16-bit) [required, an opaque entity code describing the type 
        of the interpolation, e.g. player, map, prop]
       flags:  2 bytes (16-bit) [optional, net balance limits: 
        e.g. debits_must_not_exceed_credits or credits_must_not_exceed_debits]
     past_interpolations_pending: n bytes (n-bit variant. Uses var_to_bytes_with_objects.)
      past_interpolations_posted: n bytes (n-bit variant. Uses var_to_bytes_with_objects.)
  current_interpolations_pending: n bytes (n-bit variant. Uses var_to_bytes_with_objects.)
   current_interpolations_posted: n bytes (n-bit variant. Uses var_to_bytes_with_objects.)
               timestamp: 8 bytes ( 64-bit) [reserved]
} = n bytes (n CPU cache lines)</code></pre>
</section>
</section>
</section>
<section id="positive-consequences" class="level2">
<h2 class="anchored" data-anchor-id="positive-consequences">Positive Consequences <!-- optional --></h2>
<ul>
<li>The code is based on robust view replication consensus algorithm theory.</li>
<li>The playback of the state machine is deterministic.</li>
</ul>
</section>
<section id="negative-consequences" class="level2">
<h2 class="anchored" data-anchor-id="negative-consequences">Negative Consequences <!-- optional --></h2>
<ul>
<li>Minimum of three relays.</li>
</ul>
</section>
<section id="option-graveyard" class="level2">
<h2 class="anchored" data-anchor-id="option-graveyard">Option graveyard: <!-- same as above --></h2>
<ul>
<li>Option: Current V-Sekai replication</li>
<li>Rejection Reason: Can’t link servers</li>
</ul>
</section>
<section id="if-this-enhancement-will-not-be-used-often-can-it-be-worked-around-with-a-few-lines-of-script" class="level2">
<h2 class="anchored" data-anchor-id="if-this-enhancement-will-not-be-used-often-can-it-be-worked-around-with-a-few-lines-of-script">If this enhancement will not be used often, can it be worked around with a few lines of script?</h2>
<p>Entity replication is not trivial.</p>
</section>
<section id="is-there-a-reason-why-this-should-be-core-and-done-by-us" class="level2">
<h2 class="anchored" data-anchor-id="is-there-a-reason-why-this-should-be-core-and-done-by-us">Is there a reason why this should be core and done by us?</h2>
<p>We’re doing the networking layer.</p>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References <!-- optional and numbers of links can vary --></h2>
<ul>
<li><p><a href="https://github.com/godotengine/godot-proposals/issues/3459">Add a multiplayer interface and visual nodes for SceneTree replication</a></p></li>
<li><p><a href="https://skillsmatter.com/skillscasts/5247-the-lmax-exchange-architecture-high-throughput-low-latency-and-plain-old-java">LMAX Exchange Architecture</a></p></li>
</ul>
<p>LMAX (quote):</p>
<blockquote class="blockquote">
<ol type="1">
<li>journal incoming events safely to disk, and</li>
<li>replicate to backup nodes, then</li>
<li>apply these events to the in-memory state, then</li>
<li>ACK to the client</li>
</ol>
</blockquote>
<ul>
<li><a href="https://github.com/tigerbeetledb/tigerbeetle/blob/main/docs/DESIGN.md#architecture">Tigerbeetle design</a></li>
</ul>
<p>Tigerbeetle uses viewstamp replication in the context of bank ledger credit and debit.</p>
<p>Tigerbeetle (quote):</p>
<blockquote class="blockquote">
<ol type="1">
<li>replicate incoming events safely to a quorum of distributed replicas, then</li>
<li>apply these events to the in-memory state, then</li>
<li>ACK to the client</li>
</ol>
</blockquote>
<ul>
<li><a href="https://github.com/tigerbeetledb/viewstamped-replication-made-famous">viewstamped-replication-made-famous</a></li>
<li><a href="https://pmg.csail.mit.edu/papers/vr-revisited.pdf">vr-revisited.pdf</a></li>
<li><a href="https://discord.gg/uWCGp46uG5">TigerBeetle Discord server</a></li>
<li><a href="https://docs.godotengine.org/en/latest/tutorials/math/interpolation.html">Cubic interpolation</a></li>
</ul>
</section>
<section id="interpolation-function-from-godot-engine-4" class="level2">
<h2 class="anchored" data-anchor-id="interpolation-function-from-godot-engine-4">Interpolation function from Godot Engine 4</h2>
<p>Note that this handles both nearest interpolation and cubic (with time) interpolation.</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="cb3-1"><span class="kw" style="color: #003B4F;">template</span> <span class="op" style="color: #5E5E5E;">&lt;</span><span class="kw" style="color: #003B4F;">class</span> T<span class="op" style="color: #5E5E5E;">&gt;</span></span>
<span id="cb3-2">T Animation<span class="op" style="color: #5E5E5E;">::</span>_interpolate<span class="op" style="color: #5E5E5E;">(</span><span class="at" style="color: #657422;">const</span> Vector<span class="op" style="color: #5E5E5E;">&lt;</span>TKey<span class="op" style="color: #5E5E5E;">&lt;</span>T<span class="op" style="color: #5E5E5E;">&gt;&gt;</span> <span class="op" style="color: #5E5E5E;">&amp;</span>p_keys<span class="op" style="color: #5E5E5E;">,</span> <span class="dt" style="color: #AD0000;">double</span> p_time<span class="op" style="color: #5E5E5E;">,</span> InterpolationType p_interp<span class="op" style="color: #5E5E5E;">,</span> <span class="dt" style="color: #AD0000;">bool</span> p_loop_wrap<span class="op" style="color: #5E5E5E;">,</span> <span class="dt" style="color: #AD0000;">bool</span> <span class="op" style="color: #5E5E5E;">*</span>p_ok<span class="op" style="color: #5E5E5E;">,</span> <span class="dt" style="color: #AD0000;">bool</span> p_backward<span class="op" style="color: #5E5E5E;">)</span> <span class="at" style="color: #657422;">const</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span id="cb3-3">    <span class="dt" style="color: #AD0000;">int</span> len <span class="op" style="color: #5E5E5E;">=</span> _find<span class="op" style="color: #5E5E5E;">(</span>p_keys<span class="op" style="color: #5E5E5E;">,</span> length<span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span> <span class="dv" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">;</span> <span class="co" style="color: #5E5E5E;">// try to find last key (there may be more past the end)</span></span>
<span id="cb3-4"></span>
<span id="cb3-5">    <span class="cf" style="color: #003B4F;">if</span> <span class="op" style="color: #5E5E5E;">(</span>len <span class="op" style="color: #5E5E5E;">&lt;=</span> <span class="dv" style="color: #AD0000;">0</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span id="cb3-6">        <span class="co" style="color: #5E5E5E;">// (-1 or -2 returned originally) (plus one above)</span></span>
<span id="cb3-7">        <span class="co" style="color: #5E5E5E;">// meaning no keys, or only key time is larger than length</span></span>
<span id="cb3-8">        <span class="cf" style="color: #003B4F;">if</span> <span class="op" style="color: #5E5E5E;">(</span>p_ok<span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span id="cb3-9">            <span class="op" style="color: #5E5E5E;">*</span>p_ok <span class="op" style="color: #5E5E5E;">=</span> <span class="kw" style="color: #003B4F;">false</span><span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-10">        <span class="op" style="color: #5E5E5E;">}</span></span>
<span id="cb3-11">        <span class="cf" style="color: #003B4F;">return</span> T<span class="op" style="color: #5E5E5E;">();</span></span>
<span id="cb3-12">    <span class="op" style="color: #5E5E5E;">}</span> <span class="cf" style="color: #003B4F;">else</span> <span class="cf" style="color: #003B4F;">if</span> <span class="op" style="color: #5E5E5E;">(</span>len <span class="op" style="color: #5E5E5E;">==</span> <span class="dv" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">{</span> <span class="co" style="color: #5E5E5E;">// one key found (0+1), return it</span></span>
<span id="cb3-13"></span>
<span id="cb3-14">        <span class="cf" style="color: #003B4F;">if</span> <span class="op" style="color: #5E5E5E;">(</span>p_ok<span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span id="cb3-15">            <span class="op" style="color: #5E5E5E;">*</span>p_ok <span class="op" style="color: #5E5E5E;">=</span> <span class="kw" style="color: #003B4F;">true</span><span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-16">        <span class="op" style="color: #5E5E5E;">}</span></span>
<span id="cb3-17">        <span class="cf" style="color: #003B4F;">return</span> p_keys<span class="op" style="color: #5E5E5E;">[</span><span class="dv" style="color: #AD0000;">0</span><span class="op" style="color: #5E5E5E;">].</span>value<span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-18">    <span class="op" style="color: #5E5E5E;">}</span></span>
<span id="cb3-19"></span>
<span id="cb3-20">    <span class="dt" style="color: #AD0000;">int</span> idx <span class="op" style="color: #5E5E5E;">=</span> _find<span class="op" style="color: #5E5E5E;">(</span>p_keys<span class="op" style="color: #5E5E5E;">,</span> p_time<span class="op" style="color: #5E5E5E;">,</span> p_backward<span class="op" style="color: #5E5E5E;">);</span></span>
<span id="cb3-21"></span>
<span id="cb3-22">    ERR_FAIL_COND_V<span class="op" style="color: #5E5E5E;">(</span>idx <span class="op" style="color: #5E5E5E;">==</span> <span class="op" style="color: #5E5E5E;">-</span><span class="dv" style="color: #AD0000;">2</span><span class="op" style="color: #5E5E5E;">,</span> T<span class="op" style="color: #5E5E5E;">());</span></span>
<span id="cb3-23"></span>
<span id="cb3-24">    <span class="dt" style="color: #AD0000;">bool</span> result <span class="op" style="color: #5E5E5E;">=</span> <span class="kw" style="color: #003B4F;">true</span><span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-25">    <span class="dt" style="color: #AD0000;">int</span> next <span class="op" style="color: #5E5E5E;">=</span> <span class="dv" style="color: #AD0000;">0</span><span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-26">    <span class="dt" style="color: #AD0000;">real_t</span> c <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">0.0</span><span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-27">    <span class="co" style="color: #5E5E5E;">// prepare for all cases of interpolation</span></span>
<span id="cb3-28"></span>
<span id="cb3-29">    <span class="cf" style="color: #003B4F;">if</span> <span class="op" style="color: #5E5E5E;">(</span>loop_mode <span class="op" style="color: #5E5E5E;">==</span> LOOP_LINEAR <span class="op" style="color: #5E5E5E;">&amp;&amp;</span> p_loop_wrap<span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span id="cb3-30">        <span class="co" style="color: #5E5E5E;">// loop</span></span>
<span id="cb3-31">        <span class="cf" style="color: #003B4F;">if</span> <span class="op" style="color: #5E5E5E;">(!</span>p_backward<span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span id="cb3-32">            <span class="co" style="color: #5E5E5E;">// no backward</span></span>
<span id="cb3-33">            <span class="cf" style="color: #003B4F;">if</span> <span class="op" style="color: #5E5E5E;">(</span>idx <span class="op" style="color: #5E5E5E;">&gt;=</span> <span class="dv" style="color: #AD0000;">0</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span id="cb3-34">                <span class="cf" style="color: #003B4F;">if</span> <span class="op" style="color: #5E5E5E;">(</span>idx <span class="op" style="color: #5E5E5E;">&lt;</span> len <span class="op" style="color: #5E5E5E;">-</span> <span class="dv" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span id="cb3-35">                    next <span class="op" style="color: #5E5E5E;">=</span> idx <span class="op" style="color: #5E5E5E;">+</span> <span class="dv" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-36">                    <span class="dt" style="color: #AD0000;">real_t</span> delta <span class="op" style="color: #5E5E5E;">=</span> p_keys<span class="op" style="color: #5E5E5E;">[</span>next<span class="op" style="color: #5E5E5E;">].</span>time <span class="op" style="color: #5E5E5E;">-</span> p_keys<span class="op" style="color: #5E5E5E;">[</span>idx<span class="op" style="color: #5E5E5E;">].</span>time<span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-37">                    <span class="dt" style="color: #AD0000;">real_t</span> from <span class="op" style="color: #5E5E5E;">=</span> p_time <span class="op" style="color: #5E5E5E;">-</span> p_keys<span class="op" style="color: #5E5E5E;">[</span>idx<span class="op" style="color: #5E5E5E;">].</span>time<span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-38"></span>
<span id="cb3-39">                    <span class="cf" style="color: #003B4F;">if</span> <span class="op" style="color: #5E5E5E;">(</span>Math<span class="op" style="color: #5E5E5E;">::</span>is_zero_approx<span class="op" style="color: #5E5E5E;">(</span>delta<span class="op" style="color: #5E5E5E;">))</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span id="cb3-40">                        c <span class="op" style="color: #5E5E5E;">=</span> <span class="dv" style="color: #AD0000;">0</span><span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-41">                    <span class="op" style="color: #5E5E5E;">}</span> <span class="cf" style="color: #003B4F;">else</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span id="cb3-42">                        c <span class="op" style="color: #5E5E5E;">=</span> from <span class="op" style="color: #5E5E5E;">/</span> delta<span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-43">                    <span class="op" style="color: #5E5E5E;">}</span></span>
<span id="cb3-44">                <span class="op" style="color: #5E5E5E;">}</span> <span class="cf" style="color: #003B4F;">else</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span id="cb3-45">                    next <span class="op" style="color: #5E5E5E;">=</span> <span class="dv" style="color: #AD0000;">0</span><span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-46">                    <span class="dt" style="color: #AD0000;">real_t</span> delta <span class="op" style="color: #5E5E5E;">=</span> <span class="op" style="color: #5E5E5E;">(</span>length <span class="op" style="color: #5E5E5E;">-</span> p_keys<span class="op" style="color: #5E5E5E;">[</span>idx<span class="op" style="color: #5E5E5E;">].</span>time<span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span> p_keys<span class="op" style="color: #5E5E5E;">[</span>next<span class="op" style="color: #5E5E5E;">].</span>time<span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-47">                    <span class="dt" style="color: #AD0000;">real_t</span> from <span class="op" style="color: #5E5E5E;">=</span> p_time <span class="op" style="color: #5E5E5E;">-</span> p_keys<span class="op" style="color: #5E5E5E;">[</span>idx<span class="op" style="color: #5E5E5E;">].</span>time<span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-48"></span>
<span id="cb3-49">                    <span class="cf" style="color: #003B4F;">if</span> <span class="op" style="color: #5E5E5E;">(</span>Math<span class="op" style="color: #5E5E5E;">::</span>is_zero_approx<span class="op" style="color: #5E5E5E;">(</span>delta<span class="op" style="color: #5E5E5E;">))</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span id="cb3-50">                        c <span class="op" style="color: #5E5E5E;">=</span> <span class="dv" style="color: #AD0000;">0</span><span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-51">                    <span class="op" style="color: #5E5E5E;">}</span> <span class="cf" style="color: #003B4F;">else</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span id="cb3-52">                        c <span class="op" style="color: #5E5E5E;">=</span> from <span class="op" style="color: #5E5E5E;">/</span> delta<span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-53">                    <span class="op" style="color: #5E5E5E;">}</span></span>
<span id="cb3-54">                <span class="op" style="color: #5E5E5E;">}</span></span>
<span id="cb3-55">            <span class="op" style="color: #5E5E5E;">}</span> <span class="cf" style="color: #003B4F;">else</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span id="cb3-56">                <span class="co" style="color: #5E5E5E;">// on loop, behind first key</span></span>
<span id="cb3-57">                idx <span class="op" style="color: #5E5E5E;">=</span> len <span class="op" style="color: #5E5E5E;">-</span> <span class="dv" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-58">                next <span class="op" style="color: #5E5E5E;">=</span> <span class="dv" style="color: #AD0000;">0</span><span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-59">                <span class="dt" style="color: #AD0000;">real_t</span> endtime <span class="op" style="color: #5E5E5E;">=</span> <span class="op" style="color: #5E5E5E;">(</span>length <span class="op" style="color: #5E5E5E;">-</span> p_keys<span class="op" style="color: #5E5E5E;">[</span>idx<span class="op" style="color: #5E5E5E;">].</span>time<span class="op" style="color: #5E5E5E;">);</span></span>
<span id="cb3-60">                <span class="cf" style="color: #003B4F;">if</span> <span class="op" style="color: #5E5E5E;">(</span>endtime <span class="op" style="color: #5E5E5E;">&lt;</span> <span class="dv" style="color: #AD0000;">0</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">{</span> <span class="co" style="color: #5E5E5E;">// may be keys past the end</span></span>
<span id="cb3-61">                    endtime <span class="op" style="color: #5E5E5E;">=</span> <span class="dv" style="color: #AD0000;">0</span><span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-62">                <span class="op" style="color: #5E5E5E;">}</span></span>
<span id="cb3-63">                <span class="dt" style="color: #AD0000;">real_t</span> delta <span class="op" style="color: #5E5E5E;">=</span> endtime <span class="op" style="color: #5E5E5E;">+</span> p_keys<span class="op" style="color: #5E5E5E;">[</span>next<span class="op" style="color: #5E5E5E;">].</span>time<span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-64">                <span class="dt" style="color: #AD0000;">real_t</span> from <span class="op" style="color: #5E5E5E;">=</span> endtime <span class="op" style="color: #5E5E5E;">+</span> p_time<span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-65"></span>
<span id="cb3-66">                <span class="cf" style="color: #003B4F;">if</span> <span class="op" style="color: #5E5E5E;">(</span>Math<span class="op" style="color: #5E5E5E;">::</span>is_zero_approx<span class="op" style="color: #5E5E5E;">(</span>delta<span class="op" style="color: #5E5E5E;">))</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span id="cb3-67">                    c <span class="op" style="color: #5E5E5E;">=</span> <span class="dv" style="color: #AD0000;">0</span><span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-68">                <span class="op" style="color: #5E5E5E;">}</span> <span class="cf" style="color: #003B4F;">else</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span id="cb3-69">                    c <span class="op" style="color: #5E5E5E;">=</span> from <span class="op" style="color: #5E5E5E;">/</span> delta<span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-70">                <span class="op" style="color: #5E5E5E;">}</span></span>
<span id="cb3-71">            <span class="op" style="color: #5E5E5E;">}</span></span>
<span id="cb3-72">        <span class="op" style="color: #5E5E5E;">}</span> <span class="cf" style="color: #003B4F;">else</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span id="cb3-73">            <span class="co" style="color: #5E5E5E;">// backward</span></span>
<span id="cb3-74">            <span class="cf" style="color: #003B4F;">if</span> <span class="op" style="color: #5E5E5E;">(</span>idx <span class="op" style="color: #5E5E5E;">&lt;=</span> len <span class="op" style="color: #5E5E5E;">-</span> <span class="dv" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span id="cb3-75">                <span class="cf" style="color: #003B4F;">if</span> <span class="op" style="color: #5E5E5E;">(</span>idx <span class="op" style="color: #5E5E5E;">&gt;</span> <span class="dv" style="color: #AD0000;">0</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span id="cb3-76">                    next <span class="op" style="color: #5E5E5E;">=</span> idx <span class="op" style="color: #5E5E5E;">-</span> <span class="dv" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-77">                    <span class="dt" style="color: #AD0000;">real_t</span> delta <span class="op" style="color: #5E5E5E;">=</span> <span class="op" style="color: #5E5E5E;">(</span>length <span class="op" style="color: #5E5E5E;">-</span> p_keys<span class="op" style="color: #5E5E5E;">[</span>next<span class="op" style="color: #5E5E5E;">].</span>time<span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">-</span> <span class="op" style="color: #5E5E5E;">(</span>length <span class="op" style="color: #5E5E5E;">-</span> p_keys<span class="op" style="color: #5E5E5E;">[</span>idx<span class="op" style="color: #5E5E5E;">].</span>time<span class="op" style="color: #5E5E5E;">);</span></span>
<span id="cb3-78">                    <span class="dt" style="color: #AD0000;">real_t</span> from <span class="op" style="color: #5E5E5E;">=</span> <span class="op" style="color: #5E5E5E;">(</span>length <span class="op" style="color: #5E5E5E;">-</span> p_time<span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">-</span> <span class="op" style="color: #5E5E5E;">(</span>length <span class="op" style="color: #5E5E5E;">-</span> p_keys<span class="op" style="color: #5E5E5E;">[</span>idx<span class="op" style="color: #5E5E5E;">].</span>time<span class="op" style="color: #5E5E5E;">);</span></span>
<span id="cb3-79"></span>
<span id="cb3-80">                    <span class="cf" style="color: #003B4F;">if</span> <span class="op" style="color: #5E5E5E;">(</span>Math<span class="op" style="color: #5E5E5E;">::</span>is_zero_approx<span class="op" style="color: #5E5E5E;">(</span>delta<span class="op" style="color: #5E5E5E;">))</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span id="cb3-81">                        c <span class="op" style="color: #5E5E5E;">=</span> <span class="dv" style="color: #AD0000;">0</span><span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-82">                    <span class="op" style="color: #5E5E5E;">}</span> <span class="cf" style="color: #003B4F;">else</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span id="cb3-83">                        c <span class="op" style="color: #5E5E5E;">=</span> from <span class="op" style="color: #5E5E5E;">/</span> delta<span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-84">                    <span class="op" style="color: #5E5E5E;">}</span></span>
<span id="cb3-85">                <span class="op" style="color: #5E5E5E;">}</span> <span class="cf" style="color: #003B4F;">else</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span id="cb3-86">                    next <span class="op" style="color: #5E5E5E;">=</span> len <span class="op" style="color: #5E5E5E;">-</span> <span class="dv" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-87">                    <span class="dt" style="color: #AD0000;">real_t</span> delta <span class="op" style="color: #5E5E5E;">=</span> p_keys<span class="op" style="color: #5E5E5E;">[</span>idx<span class="op" style="color: #5E5E5E;">].</span>time <span class="op" style="color: #5E5E5E;">+</span> <span class="op" style="color: #5E5E5E;">(</span>length <span class="op" style="color: #5E5E5E;">-</span> p_keys<span class="op" style="color: #5E5E5E;">[</span>next<span class="op" style="color: #5E5E5E;">].</span>time<span class="op" style="color: #5E5E5E;">);</span></span>
<span id="cb3-88">                    <span class="dt" style="color: #AD0000;">real_t</span> from <span class="op" style="color: #5E5E5E;">=</span> <span class="op" style="color: #5E5E5E;">(</span>length <span class="op" style="color: #5E5E5E;">-</span> p_time<span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">-</span> <span class="op" style="color: #5E5E5E;">(</span>length <span class="op" style="color: #5E5E5E;">-</span> p_keys<span class="op" style="color: #5E5E5E;">[</span>idx<span class="op" style="color: #5E5E5E;">].</span>time<span class="op" style="color: #5E5E5E;">);</span></span>
<span id="cb3-89"></span>
<span id="cb3-90">                    <span class="cf" style="color: #003B4F;">if</span> <span class="op" style="color: #5E5E5E;">(</span>Math<span class="op" style="color: #5E5E5E;">::</span>is_zero_approx<span class="op" style="color: #5E5E5E;">(</span>delta<span class="op" style="color: #5E5E5E;">))</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span id="cb3-91">                        c <span class="op" style="color: #5E5E5E;">=</span> <span class="dv" style="color: #AD0000;">0</span><span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-92">                    <span class="op" style="color: #5E5E5E;">}</span> <span class="cf" style="color: #003B4F;">else</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span id="cb3-93">                        c <span class="op" style="color: #5E5E5E;">=</span> from <span class="op" style="color: #5E5E5E;">/</span> delta<span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-94">                    <span class="op" style="color: #5E5E5E;">}</span></span>
<span id="cb3-95">                <span class="op" style="color: #5E5E5E;">}</span></span>
<span id="cb3-96">            <span class="op" style="color: #5E5E5E;">}</span> <span class="cf" style="color: #003B4F;">else</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span id="cb3-97">                <span class="co" style="color: #5E5E5E;">// on loop, in front of last key</span></span>
<span id="cb3-98">                idx <span class="op" style="color: #5E5E5E;">=</span> <span class="dv" style="color: #AD0000;">0</span><span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-99">                next <span class="op" style="color: #5E5E5E;">=</span> len <span class="op" style="color: #5E5E5E;">-</span> <span class="dv" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-100">                <span class="dt" style="color: #AD0000;">real_t</span> endtime <span class="op" style="color: #5E5E5E;">=</span> p_keys<span class="op" style="color: #5E5E5E;">[</span>idx<span class="op" style="color: #5E5E5E;">].</span>time<span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-101">                <span class="cf" style="color: #003B4F;">if</span> <span class="op" style="color: #5E5E5E;">(</span>endtime <span class="op" style="color: #5E5E5E;">&gt;</span> length<span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">{</span> <span class="co" style="color: #5E5E5E;">// may be keys past the end</span></span>
<span id="cb3-102">                    endtime <span class="op" style="color: #5E5E5E;">=</span> length<span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-103">                <span class="op" style="color: #5E5E5E;">}</span></span>
<span id="cb3-104">                <span class="dt" style="color: #AD0000;">real_t</span> delta <span class="op" style="color: #5E5E5E;">=</span> p_keys<span class="op" style="color: #5E5E5E;">[</span>next<span class="op" style="color: #5E5E5E;">].</span>time <span class="op" style="color: #5E5E5E;">-</span> endtime<span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-105">                <span class="dt" style="color: #AD0000;">real_t</span> from <span class="op" style="color: #5E5E5E;">=</span> p_time <span class="op" style="color: #5E5E5E;">-</span> endtime<span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-106"></span>
<span id="cb3-107">                <span class="cf" style="color: #003B4F;">if</span> <span class="op" style="color: #5E5E5E;">(</span>Math<span class="op" style="color: #5E5E5E;">::</span>is_zero_approx<span class="op" style="color: #5E5E5E;">(</span>delta<span class="op" style="color: #5E5E5E;">))</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span id="cb3-108">                    c <span class="op" style="color: #5E5E5E;">=</span> <span class="dv" style="color: #AD0000;">0</span><span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-109">                <span class="op" style="color: #5E5E5E;">}</span> <span class="cf" style="color: #003B4F;">else</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span id="cb3-110">                    c <span class="op" style="color: #5E5E5E;">=</span> from <span class="op" style="color: #5E5E5E;">/</span> delta<span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-111">                <span class="op" style="color: #5E5E5E;">}</span></span>
<span id="cb3-112">            <span class="op" style="color: #5E5E5E;">}</span></span>
<span id="cb3-113">        <span class="op" style="color: #5E5E5E;">}</span></span>
<span id="cb3-114">    <span class="op" style="color: #5E5E5E;">}</span> <span class="cf" style="color: #003B4F;">else</span> <span class="op" style="color: #5E5E5E;">{</span> <span class="co" style="color: #5E5E5E;">// no loop</span></span>
<span id="cb3-115">        <span class="cf" style="color: #003B4F;">if</span> <span class="op" style="color: #5E5E5E;">(!</span>p_backward<span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span id="cb3-116">            <span class="cf" style="color: #003B4F;">if</span> <span class="op" style="color: #5E5E5E;">(</span>idx <span class="op" style="color: #5E5E5E;">&gt;=</span> <span class="dv" style="color: #AD0000;">0</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span id="cb3-117">                <span class="cf" style="color: #003B4F;">if</span> <span class="op" style="color: #5E5E5E;">(</span>idx <span class="op" style="color: #5E5E5E;">&lt;</span> len <span class="op" style="color: #5E5E5E;">-</span> <span class="dv" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span id="cb3-118">                    next <span class="op" style="color: #5E5E5E;">=</span> idx <span class="op" style="color: #5E5E5E;">+</span> <span class="dv" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-119">                    <span class="dt" style="color: #AD0000;">real_t</span> delta <span class="op" style="color: #5E5E5E;">=</span> p_keys<span class="op" style="color: #5E5E5E;">[</span>next<span class="op" style="color: #5E5E5E;">].</span>time <span class="op" style="color: #5E5E5E;">-</span> p_keys<span class="op" style="color: #5E5E5E;">[</span>idx<span class="op" style="color: #5E5E5E;">].</span>time<span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-120">                    <span class="dt" style="color: #AD0000;">real_t</span> from <span class="op" style="color: #5E5E5E;">=</span> p_time <span class="op" style="color: #5E5E5E;">-</span> p_keys<span class="op" style="color: #5E5E5E;">[</span>idx<span class="op" style="color: #5E5E5E;">].</span>time<span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-121"></span>
<span id="cb3-122">                    <span class="cf" style="color: #003B4F;">if</span> <span class="op" style="color: #5E5E5E;">(</span>Math<span class="op" style="color: #5E5E5E;">::</span>is_zero_approx<span class="op" style="color: #5E5E5E;">(</span>delta<span class="op" style="color: #5E5E5E;">))</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span id="cb3-123">                        c <span class="op" style="color: #5E5E5E;">=</span> <span class="dv" style="color: #AD0000;">0</span><span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-124">                    <span class="op" style="color: #5E5E5E;">}</span> <span class="cf" style="color: #003B4F;">else</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span id="cb3-125">                        c <span class="op" style="color: #5E5E5E;">=</span> from <span class="op" style="color: #5E5E5E;">/</span> delta<span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-126">                    <span class="op" style="color: #5E5E5E;">}</span></span>
<span id="cb3-127">                <span class="op" style="color: #5E5E5E;">}</span> <span class="cf" style="color: #003B4F;">else</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span id="cb3-128">                    next <span class="op" style="color: #5E5E5E;">=</span> idx<span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-129">                <span class="op" style="color: #5E5E5E;">}</span></span>
<span id="cb3-130">            <span class="op" style="color: #5E5E5E;">}</span> <span class="cf" style="color: #003B4F;">else</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span id="cb3-131">                idx <span class="op" style="color: #5E5E5E;">=</span> next <span class="op" style="color: #5E5E5E;">=</span> <span class="dv" style="color: #AD0000;">0</span><span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-132">            <span class="op" style="color: #5E5E5E;">}</span></span>
<span id="cb3-133">        <span class="op" style="color: #5E5E5E;">}</span> <span class="cf" style="color: #003B4F;">else</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span id="cb3-134">            <span class="cf" style="color: #003B4F;">if</span> <span class="op" style="color: #5E5E5E;">(</span>idx <span class="op" style="color: #5E5E5E;">&lt;=</span> len <span class="op" style="color: #5E5E5E;">-</span> <span class="dv" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span id="cb3-135">                <span class="cf" style="color: #003B4F;">if</span> <span class="op" style="color: #5E5E5E;">(</span>idx <span class="op" style="color: #5E5E5E;">&gt;</span> <span class="dv" style="color: #AD0000;">0</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span id="cb3-136">                    next <span class="op" style="color: #5E5E5E;">=</span> idx <span class="op" style="color: #5E5E5E;">-</span> <span class="dv" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-137">                    <span class="dt" style="color: #AD0000;">real_t</span> delta <span class="op" style="color: #5E5E5E;">=</span> <span class="op" style="color: #5E5E5E;">(</span>length <span class="op" style="color: #5E5E5E;">-</span> p_keys<span class="op" style="color: #5E5E5E;">[</span>next<span class="op" style="color: #5E5E5E;">].</span>time<span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">-</span> <span class="op" style="color: #5E5E5E;">(</span>length <span class="op" style="color: #5E5E5E;">-</span> p_keys<span class="op" style="color: #5E5E5E;">[</span>idx<span class="op" style="color: #5E5E5E;">].</span>time<span class="op" style="color: #5E5E5E;">);</span></span>
<span id="cb3-138">                    <span class="dt" style="color: #AD0000;">real_t</span> from <span class="op" style="color: #5E5E5E;">=</span> <span class="op" style="color: #5E5E5E;">(</span>length <span class="op" style="color: #5E5E5E;">-</span> p_time<span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">-</span> <span class="op" style="color: #5E5E5E;">(</span>length <span class="op" style="color: #5E5E5E;">-</span> p_keys<span class="op" style="color: #5E5E5E;">[</span>idx<span class="op" style="color: #5E5E5E;">].</span>time<span class="op" style="color: #5E5E5E;">);</span></span>
<span id="cb3-139"></span>
<span id="cb3-140">                    <span class="cf" style="color: #003B4F;">if</span> <span class="op" style="color: #5E5E5E;">(</span>Math<span class="op" style="color: #5E5E5E;">::</span>is_zero_approx<span class="op" style="color: #5E5E5E;">(</span>delta<span class="op" style="color: #5E5E5E;">))</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span id="cb3-141">                        c <span class="op" style="color: #5E5E5E;">=</span> <span class="dv" style="color: #AD0000;">0</span><span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-142">                    <span class="op" style="color: #5E5E5E;">}</span> <span class="cf" style="color: #003B4F;">else</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span id="cb3-143">                        c <span class="op" style="color: #5E5E5E;">=</span> from <span class="op" style="color: #5E5E5E;">/</span> delta<span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-144">                    <span class="op" style="color: #5E5E5E;">}</span></span>
<span id="cb3-145"></span>
<span id="cb3-146">                <span class="op" style="color: #5E5E5E;">}</span> <span class="cf" style="color: #003B4F;">else</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span id="cb3-147">                    next <span class="op" style="color: #5E5E5E;">=</span> idx<span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-148">                <span class="op" style="color: #5E5E5E;">}</span></span>
<span id="cb3-149">            <span class="op" style="color: #5E5E5E;">}</span> <span class="cf" style="color: #003B4F;">else</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span id="cb3-150">                idx <span class="op" style="color: #5E5E5E;">=</span> next <span class="op" style="color: #5E5E5E;">=</span> len <span class="op" style="color: #5E5E5E;">-</span> <span class="dv" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-151">            <span class="op" style="color: #5E5E5E;">}</span></span>
<span id="cb3-152">        <span class="op" style="color: #5E5E5E;">}</span></span>
<span id="cb3-153">    <span class="op" style="color: #5E5E5E;">}</span></span>
<span id="cb3-154"></span>
<span id="cb3-155">    <span class="cf" style="color: #003B4F;">if</span> <span class="op" style="color: #5E5E5E;">(</span>p_ok<span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span id="cb3-156">        <span class="op" style="color: #5E5E5E;">*</span>p_ok <span class="op" style="color: #5E5E5E;">=</span> result<span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-157">    <span class="op" style="color: #5E5E5E;">}</span></span>
<span id="cb3-158">    <span class="cf" style="color: #003B4F;">if</span> <span class="op" style="color: #5E5E5E;">(!</span>result<span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span id="cb3-159">        <span class="cf" style="color: #003B4F;">return</span> T<span class="op" style="color: #5E5E5E;">();</span></span>
<span id="cb3-160">    <span class="op" style="color: #5E5E5E;">}</span></span>
<span id="cb3-161"></span>
<span id="cb3-162">    <span class="dt" style="color: #AD0000;">real_t</span> <span class="fu" style="color: #4758AB;">tr</span> <span class="op" style="color: #5E5E5E;">=</span> p_keys<span class="op" style="color: #5E5E5E;">[</span>idx<span class="op" style="color: #5E5E5E;">].</span>transition<span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-163"></span>
<span id="cb3-164">    <span class="cf" style="color: #003B4F;">if</span> <span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;">tr</span> <span class="op" style="color: #5E5E5E;">==</span> <span class="dv" style="color: #AD0000;">0</span> <span class="op" style="color: #5E5E5E;">||</span> idx <span class="op" style="color: #5E5E5E;">==</span> next<span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span id="cb3-165">        <span class="co" style="color: #5E5E5E;">// don't interpolate if not needed</span></span>
<span id="cb3-166">        <span class="cf" style="color: #003B4F;">return</span> p_keys<span class="op" style="color: #5E5E5E;">[</span>idx<span class="op" style="color: #5E5E5E;">].</span>value<span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-167">    <span class="op" style="color: #5E5E5E;">}</span></span>
<span id="cb3-168"></span>
<span id="cb3-169">    <span class="cf" style="color: #003B4F;">if</span> <span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;">tr</span> <span class="op" style="color: #5E5E5E;">!=</span> <span class="fl" style="color: #AD0000;">1.0</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span id="cb3-170">        c <span class="op" style="color: #5E5E5E;">=</span> Math<span class="op" style="color: #5E5E5E;">::</span>ease<span class="op" style="color: #5E5E5E;">(</span>c<span class="op" style="color: #5E5E5E;">,</span> <span class="fu" style="color: #4758AB;">tr</span><span class="op" style="color: #5E5E5E;">);</span></span>
<span id="cb3-171">    <span class="op" style="color: #5E5E5E;">}</span></span>
<span id="cb3-172"></span>
<span id="cb3-173">    <span class="cf" style="color: #003B4F;">switch</span> <span class="op" style="color: #5E5E5E;">(</span>p_interp<span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span id="cb3-174">        <span class="cf" style="color: #003B4F;">case</span> INTERPOLATION_NEAREST<span class="op" style="color: #5E5E5E;">:</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span id="cb3-175">            <span class="cf" style="color: #003B4F;">return</span> p_keys<span class="op" style="color: #5E5E5E;">[</span>idx<span class="op" style="color: #5E5E5E;">].</span>value<span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-176">        <span class="op" style="color: #5E5E5E;">}</span> <span class="cf" style="color: #003B4F;">break</span><span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-177">        <span class="cf" style="color: #003B4F;">case</span> INTERPOLATION_LINEAR<span class="op" style="color: #5E5E5E;">:</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span id="cb3-178">            <span class="cf" style="color: #003B4F;">return</span> _interpolate<span class="op" style="color: #5E5E5E;">(</span>p_keys<span class="op" style="color: #5E5E5E;">[</span>idx<span class="op" style="color: #5E5E5E;">].</span>value<span class="op" style="color: #5E5E5E;">,</span> p_keys<span class="op" style="color: #5E5E5E;">[</span>next<span class="op" style="color: #5E5E5E;">].</span>value<span class="op" style="color: #5E5E5E;">,</span> c<span class="op" style="color: #5E5E5E;">);</span></span>
<span id="cb3-179">        <span class="op" style="color: #5E5E5E;">}</span> <span class="cf" style="color: #003B4F;">break</span><span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-180">        <span class="cf" style="color: #003B4F;">case</span> INTERPOLATION_LINEAR_ANGLE<span class="op" style="color: #5E5E5E;">:</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span id="cb3-181">            <span class="cf" style="color: #003B4F;">return</span> _interpolate_angle<span class="op" style="color: #5E5E5E;">(</span>p_keys<span class="op" style="color: #5E5E5E;">[</span>idx<span class="op" style="color: #5E5E5E;">].</span>value<span class="op" style="color: #5E5E5E;">,</span> p_keys<span class="op" style="color: #5E5E5E;">[</span>next<span class="op" style="color: #5E5E5E;">].</span>value<span class="op" style="color: #5E5E5E;">,</span> c<span class="op" style="color: #5E5E5E;">);</span></span>
<span id="cb3-182">        <span class="op" style="color: #5E5E5E;">}</span> <span class="cf" style="color: #003B4F;">break</span><span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-183">        <span class="cf" style="color: #003B4F;">case</span> INTERPOLATION_CUBIC<span class="op" style="color: #5E5E5E;">:</span></span>
<span id="cb3-184">        <span class="cf" style="color: #003B4F;">case</span> INTERPOLATION_CUBIC_ANGLE<span class="op" style="color: #5E5E5E;">:</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span id="cb3-185">            <span class="dt" style="color: #AD0000;">int</span> pre <span class="op" style="color: #5E5E5E;">=</span> <span class="dv" style="color: #AD0000;">0</span><span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-186">            <span class="dt" style="color: #AD0000;">int</span> post <span class="op" style="color: #5E5E5E;">=</span> <span class="dv" style="color: #AD0000;">0</span><span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-187">            <span class="cf" style="color: #003B4F;">if</span> <span class="op" style="color: #5E5E5E;">(!</span>p_backward<span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span id="cb3-188">                pre <span class="op" style="color: #5E5E5E;">=</span> idx <span class="op" style="color: #5E5E5E;">-</span> <span class="dv" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-189">                <span class="cf" style="color: #003B4F;">if</span> <span class="op" style="color: #5E5E5E;">(</span>pre <span class="op" style="color: #5E5E5E;">&lt;</span> <span class="dv" style="color: #AD0000;">0</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span id="cb3-190">                    <span class="cf" style="color: #003B4F;">if</span> <span class="op" style="color: #5E5E5E;">(</span>loop_mode <span class="op" style="color: #5E5E5E;">==</span> LOOP_LINEAR <span class="op" style="color: #5E5E5E;">&amp;&amp;</span> p_loop_wrap<span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span id="cb3-191">                        pre <span class="op" style="color: #5E5E5E;">=</span> len <span class="op" style="color: #5E5E5E;">-</span> <span class="dv" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-192">                    <span class="op" style="color: #5E5E5E;">}</span> <span class="cf" style="color: #003B4F;">else</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span id="cb3-193">                        pre <span class="op" style="color: #5E5E5E;">=</span> <span class="dv" style="color: #AD0000;">0</span><span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-194">                    <span class="op" style="color: #5E5E5E;">}</span></span>
<span id="cb3-195">                <span class="op" style="color: #5E5E5E;">}</span></span>
<span id="cb3-196">                post <span class="op" style="color: #5E5E5E;">=</span> next <span class="op" style="color: #5E5E5E;">+</span> <span class="dv" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-197">                <span class="cf" style="color: #003B4F;">if</span> <span class="op" style="color: #5E5E5E;">(</span>post <span class="op" style="color: #5E5E5E;">&gt;=</span> len<span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span id="cb3-198">                    <span class="cf" style="color: #003B4F;">if</span> <span class="op" style="color: #5E5E5E;">(</span>loop_mode <span class="op" style="color: #5E5E5E;">==</span> LOOP_LINEAR <span class="op" style="color: #5E5E5E;">&amp;&amp;</span> p_loop_wrap<span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span id="cb3-199">                        post <span class="op" style="color: #5E5E5E;">=</span> <span class="dv" style="color: #AD0000;">0</span><span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-200">                    <span class="op" style="color: #5E5E5E;">}</span> <span class="cf" style="color: #003B4F;">else</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span id="cb3-201">                        post <span class="op" style="color: #5E5E5E;">=</span> next<span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-202">                    <span class="op" style="color: #5E5E5E;">}</span></span>
<span id="cb3-203">                <span class="op" style="color: #5E5E5E;">}</span></span>
<span id="cb3-204">            <span class="op" style="color: #5E5E5E;">}</span> <span class="cf" style="color: #003B4F;">else</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span id="cb3-205">                pre <span class="op" style="color: #5E5E5E;">=</span> idx <span class="op" style="color: #5E5E5E;">+</span> <span class="dv" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-206">                <span class="cf" style="color: #003B4F;">if</span> <span class="op" style="color: #5E5E5E;">(</span>pre <span class="op" style="color: #5E5E5E;">&gt;=</span> len<span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span id="cb3-207">                    <span class="cf" style="color: #003B4F;">if</span> <span class="op" style="color: #5E5E5E;">(</span>loop_mode <span class="op" style="color: #5E5E5E;">==</span> LOOP_LINEAR <span class="op" style="color: #5E5E5E;">&amp;&amp;</span> p_loop_wrap<span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span id="cb3-208">                        pre <span class="op" style="color: #5E5E5E;">=</span> <span class="dv" style="color: #AD0000;">0</span><span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-209">                    <span class="op" style="color: #5E5E5E;">}</span> <span class="cf" style="color: #003B4F;">else</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span id="cb3-210">                        pre <span class="op" style="color: #5E5E5E;">=</span> idx<span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-211">                    <span class="op" style="color: #5E5E5E;">}</span></span>
<span id="cb3-212">                <span class="op" style="color: #5E5E5E;">}</span></span>
<span id="cb3-213">                post <span class="op" style="color: #5E5E5E;">=</span> next <span class="op" style="color: #5E5E5E;">-</span> <span class="dv" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-214">                <span class="cf" style="color: #003B4F;">if</span> <span class="op" style="color: #5E5E5E;">(</span>post <span class="op" style="color: #5E5E5E;">&lt;</span> <span class="dv" style="color: #AD0000;">0</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span id="cb3-215">                    <span class="cf" style="color: #003B4F;">if</span> <span class="op" style="color: #5E5E5E;">(</span>loop_mode <span class="op" style="color: #5E5E5E;">==</span> LOOP_LINEAR <span class="op" style="color: #5E5E5E;">&amp;&amp;</span> p_loop_wrap<span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span id="cb3-216">                        post <span class="op" style="color: #5E5E5E;">=</span> len <span class="op" style="color: #5E5E5E;">-</span> <span class="dv" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-217">                    <span class="op" style="color: #5E5E5E;">}</span> <span class="cf" style="color: #003B4F;">else</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span id="cb3-218">                        post <span class="op" style="color: #5E5E5E;">=</span> <span class="dv" style="color: #AD0000;">0</span><span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-219">                    <span class="op" style="color: #5E5E5E;">}</span></span>
<span id="cb3-220">                <span class="op" style="color: #5E5E5E;">}</span></span>
<span id="cb3-221">            <span class="op" style="color: #5E5E5E;">}</span></span>
<span id="cb3-222"></span>
<span id="cb3-223">            <span class="dt" style="color: #AD0000;">real_t</span> <span class="dt" style="color: #AD0000;">pre_t</span> <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">0.0</span><span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-224">            <span class="dt" style="color: #AD0000;">real_t</span> <span class="dt" style="color: #AD0000;">to_t</span> <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">0.0</span><span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-225">            <span class="dt" style="color: #AD0000;">real_t</span> <span class="dt" style="color: #AD0000;">post_t</span> <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">0.0</span><span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-226">            <span class="cf" style="color: #003B4F;">if</span> <span class="op" style="color: #5E5E5E;">(</span>loop_mode <span class="op" style="color: #5E5E5E;">==</span> LOOP_LINEAR <span class="op" style="color: #5E5E5E;">&amp;&amp;</span> p_loop_wrap<span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span id="cb3-227">                <span class="dt" style="color: #AD0000;">pre_t</span> <span class="op" style="color: #5E5E5E;">=</span> pre <span class="op" style="color: #5E5E5E;">&gt;</span> idx <span class="op" style="color: #5E5E5E;">?</span> <span class="op" style="color: #5E5E5E;">-</span>length <span class="op" style="color: #5E5E5E;">+</span> p_keys<span class="op" style="color: #5E5E5E;">[</span>pre<span class="op" style="color: #5E5E5E;">].</span>time <span class="op" style="color: #5E5E5E;">-</span> p_keys<span class="op" style="color: #5E5E5E;">[</span>idx<span class="op" style="color: #5E5E5E;">].</span>time <span class="op" style="color: #5E5E5E;">:</span> p_keys<span class="op" style="color: #5E5E5E;">[</span>pre<span class="op" style="color: #5E5E5E;">].</span>time <span class="op" style="color: #5E5E5E;">-</span> p_keys<span class="op" style="color: #5E5E5E;">[</span>idx<span class="op" style="color: #5E5E5E;">].</span>time<span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-228">                <span class="dt" style="color: #AD0000;">to_t</span> <span class="op" style="color: #5E5E5E;">=</span> next <span class="op" style="color: #5E5E5E;">&lt;</span> idx <span class="op" style="color: #5E5E5E;">?</span> length <span class="op" style="color: #5E5E5E;">+</span> p_keys<span class="op" style="color: #5E5E5E;">[</span>next<span class="op" style="color: #5E5E5E;">].</span>time <span class="op" style="color: #5E5E5E;">-</span> p_keys<span class="op" style="color: #5E5E5E;">[</span>idx<span class="op" style="color: #5E5E5E;">].</span>time <span class="op" style="color: #5E5E5E;">:</span> p_keys<span class="op" style="color: #5E5E5E;">[</span>next<span class="op" style="color: #5E5E5E;">].</span>time <span class="op" style="color: #5E5E5E;">-</span> p_keys<span class="op" style="color: #5E5E5E;">[</span>idx<span class="op" style="color: #5E5E5E;">].</span>time<span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-229">                <span class="dt" style="color: #AD0000;">post_t</span> <span class="op" style="color: #5E5E5E;">=</span> next <span class="op" style="color: #5E5E5E;">&lt;</span> idx <span class="op" style="color: #5E5E5E;">||</span> post <span class="op" style="color: #5E5E5E;">&lt;=</span> idx <span class="op" style="color: #5E5E5E;">?</span> length <span class="op" style="color: #5E5E5E;">+</span> p_keys<span class="op" style="color: #5E5E5E;">[</span>post<span class="op" style="color: #5E5E5E;">].</span>time <span class="op" style="color: #5E5E5E;">-</span> p_keys<span class="op" style="color: #5E5E5E;">[</span>idx<span class="op" style="color: #5E5E5E;">].</span>time <span class="op" style="color: #5E5E5E;">:</span> p_keys<span class="op" style="color: #5E5E5E;">[</span>post<span class="op" style="color: #5E5E5E;">].</span>time <span class="op" style="color: #5E5E5E;">-</span> p_keys<span class="op" style="color: #5E5E5E;">[</span>idx<span class="op" style="color: #5E5E5E;">].</span>time<span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-230">            <span class="op" style="color: #5E5E5E;">}</span> <span class="cf" style="color: #003B4F;">else</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span id="cb3-231">                <span class="dt" style="color: #AD0000;">pre_t</span> <span class="op" style="color: #5E5E5E;">=</span> p_keys<span class="op" style="color: #5E5E5E;">[</span>pre<span class="op" style="color: #5E5E5E;">].</span>time <span class="op" style="color: #5E5E5E;">-</span> p_keys<span class="op" style="color: #5E5E5E;">[</span>idx<span class="op" style="color: #5E5E5E;">].</span>time<span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-232">                <span class="dt" style="color: #AD0000;">to_t</span> <span class="op" style="color: #5E5E5E;">=</span> p_keys<span class="op" style="color: #5E5E5E;">[</span>next<span class="op" style="color: #5E5E5E;">].</span>time <span class="op" style="color: #5E5E5E;">-</span> p_keys<span class="op" style="color: #5E5E5E;">[</span>idx<span class="op" style="color: #5E5E5E;">].</span>time<span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-233">                <span class="dt" style="color: #AD0000;">post_t</span> <span class="op" style="color: #5E5E5E;">=</span> p_keys<span class="op" style="color: #5E5E5E;">[</span>post<span class="op" style="color: #5E5E5E;">].</span>time <span class="op" style="color: #5E5E5E;">-</span> p_keys<span class="op" style="color: #5E5E5E;">[</span>idx<span class="op" style="color: #5E5E5E;">].</span>time<span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-234">            <span class="op" style="color: #5E5E5E;">}</span></span>
<span id="cb3-235"></span>
<span id="cb3-236">            <span class="cf" style="color: #003B4F;">if</span> <span class="op" style="color: #5E5E5E;">(</span>p_interp <span class="op" style="color: #5E5E5E;">==</span> INTERPOLATION_CUBIC_ANGLE<span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span id="cb3-237">                <span class="cf" style="color: #003B4F;">return</span> _cubic_interpolate_angle_in_time<span class="op" style="color: #5E5E5E;">(</span></span>
<span id="cb3-238">                        p_keys<span class="op" style="color: #5E5E5E;">[</span>pre<span class="op" style="color: #5E5E5E;">].</span>value<span class="op" style="color: #5E5E5E;">,</span> p_keys<span class="op" style="color: #5E5E5E;">[</span>idx<span class="op" style="color: #5E5E5E;">].</span>value<span class="op" style="color: #5E5E5E;">,</span> p_keys<span class="op" style="color: #5E5E5E;">[</span>next<span class="op" style="color: #5E5E5E;">].</span>value<span class="op" style="color: #5E5E5E;">,</span> p_keys<span class="op" style="color: #5E5E5E;">[</span>post<span class="op" style="color: #5E5E5E;">].</span>value<span class="op" style="color: #5E5E5E;">,</span> c<span class="op" style="color: #5E5E5E;">,</span></span>
<span id="cb3-239">                        <span class="dt" style="color: #AD0000;">pre_t</span><span class="op" style="color: #5E5E5E;">,</span> <span class="dt" style="color: #AD0000;">to_t</span><span class="op" style="color: #5E5E5E;">,</span> <span class="dt" style="color: #AD0000;">post_t</span><span class="op" style="color: #5E5E5E;">);</span></span>
<span id="cb3-240">            <span class="op" style="color: #5E5E5E;">}</span></span>
<span id="cb3-241">            <span class="cf" style="color: #003B4F;">return</span> _cubic_interpolate_in_time<span class="op" style="color: #5E5E5E;">(</span></span>
<span id="cb3-242">                    p_keys<span class="op" style="color: #5E5E5E;">[</span>pre<span class="op" style="color: #5E5E5E;">].</span>value<span class="op" style="color: #5E5E5E;">,</span> p_keys<span class="op" style="color: #5E5E5E;">[</span>idx<span class="op" style="color: #5E5E5E;">].</span>value<span class="op" style="color: #5E5E5E;">,</span> p_keys<span class="op" style="color: #5E5E5E;">[</span>next<span class="op" style="color: #5E5E5E;">].</span>value<span class="op" style="color: #5E5E5E;">,</span> p_keys<span class="op" style="color: #5E5E5E;">[</span>post<span class="op" style="color: #5E5E5E;">].</span>value<span class="op" style="color: #5E5E5E;">,</span> c<span class="op" style="color: #5E5E5E;">,</span></span>
<span id="cb3-243">                    <span class="dt" style="color: #AD0000;">pre_t</span><span class="op" style="color: #5E5E5E;">,</span> <span class="dt" style="color: #AD0000;">to_t</span><span class="op" style="color: #5E5E5E;">,</span> <span class="dt" style="color: #AD0000;">post_t</span><span class="op" style="color: #5E5E5E;">);</span></span>
<span id="cb3-244">        <span class="op" style="color: #5E5E5E;">}</span> <span class="cf" style="color: #003B4F;">break</span><span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-245">        <span class="cf" style="color: #003B4F;">default</span><span class="op" style="color: #5E5E5E;">:</span></span>
<span id="cb3-246">            <span class="cf" style="color: #003B4F;">return</span> p_keys<span class="op" style="color: #5E5E5E;">[</span>idx<span class="op" style="color: #5E5E5E;">].</span>value<span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb3-247">    <span class="op" style="color: #5E5E5E;">}</span></span>
<span id="cb3-248"></span>
<span id="cb3-249">    <span class="co" style="color: #5E5E5E;">// do a barrel roll</span></span>
<span id="cb3-250"><span class="op" style="color: #5E5E5E;">}</span></span></code></pre></div>
</section>
<section id="derivative-license" class="level2">
<h2 class="anchored" data-anchor-id="derivative-license">Derivative License</h2>
<p>Copyright (c) 2022 V-Sekai contributors.</p>
<p>Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the “Software”), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:</p>
<p>The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.</p>
<p>THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p>


</section>
</section>

 ]]></description>
  <guid>https://v-sekai.github.io/decisions/20221016-v-sekai-view-replication.html</guid>
  <pubDate>Wed, 30 Nov 2022 17:52:44 GMT</pubDate>
</item>
<item>
  <title></title>
  <link>https://v-sekai.github.io/decisions/20221014-networking-overhaul-proposal.html</link>
  <description><![CDATA[ 



<section id="networking-overhaul" class="level1">
<h1>Networking Overhaul</h1>
<ul>
<li>Status: draft</li>
<li>Deciders: V-Sekai, Malek, Lyuma, SaracenOne, Fire,</li>
<li>Tags: Networking,</li>
</ul>
<section id="context-and-problem-statement" class="level2">
<h2 class="anchored" data-anchor-id="context-and-problem-statement">Context and Problem Statement</h2>
<p>We seek to solve these issues:</p>
<ul>
<li><strong>(A)</strong> Use godot 4.0’s networking tools.</li>
<li><strong>(B)</strong> Use a relay server that doesn’t run any game code, rather than a headless V-Sekai server.</li>
<li><strong>(C)</strong> Make the costs of hosting V-Sekai as small as possible.</li>
<li><strong>(D)</strong> Write the server in Rust, for the speed and safety guarantees.</li>
<li><strong>(E)</strong> Make networking highly scalable for a single server.</li>
<li><strong>(F)</strong> Allow a client to connect to multiple servers simultaneously without issues, for seamless travel and portals.</li>
<li><strong>(G)</strong> Synchronize state between clients</li>
</ul>
<p>Note: This proposal does not cover Permissions, and is based in part on the previous Entity Networking proposal.</p>
</section>
<section id="describe-the-proposed-option-and-how-it-helps-to-overcome-the-problem-or-limitation" class="level2">
<h2 class="anchored" data-anchor-id="describe-the-proposed-option-and-how-it-helps-to-overcome-the-problem-or-limitation">Describe the proposed option and how it helps to overcome the problem or limitation</h2>
<p>By using the technologies described below, we will cover A-G.</p>
</section>
<section id="describe-how-your-proposal-will-work-with-code-pseudo-code-mock-ups-andor-diagrams" class="level2">
<h2 class="anchored" data-anchor-id="describe-how-your-proposal-will-work-with-code-pseudo-code-mock-ups-andor-diagrams">Describe how your proposal will work, with code, pseudo-code, mock-ups, and/or diagrams</h2>
<section id="a.-state-locking-model" class="level3">
<h3 class="anchored" data-anchor-id="a.-state-locking-model">A. State Locking Model</h3>
<p>To reduce complexity, latency, and processing power, we have created a simple Mastership/Ownership model.</p>
<p>Clients are defined as individuals connecting to a Server, they have their own v-sekai game instance running.</p>
<p>The Relay Server, as of now, does not contain information about the state of the world, the only information the Relay Server contains is on Mastership/Ownership rules.</p>
<pre><code>P1 connects to the Server.

P2 connects to the Server.

P3 connects to the Server.

P1 spawns in a Ball.

Server marks that P1 has both Mastership and Ownership of Ball.

Server synchronizes with P1 and sends the state of the Ball to P2, its location, rotation, the very fact of its existence, and its owner, master, and rule.
</code></pre>
<p>Server State</p>
<table class="table">
<thead>
<tr class="header">
<th>Objects</th>
<th>Master</th>
<th>Owner</th>
<th>Rule</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Ball</td>
<td>P1</td>
<td>P1</td>
<td>Ask</td>
</tr>
</tbody>
</table>
<p>What does this mean?</p>
<section id="ownership" class="level4">
<h4 class="anchored" data-anchor-id="ownership">Ownership</h4>
<p>Since P1 is the Owner of the Ball, this means that P1 is the only one who can change the state of the ball. When Server synchronizes, if P2 were to have the ball in a different location then P1, the Server would tell P2 that the Ball is in the location P1 has it, and would do the same for P3. It can be thought of as a <em>mutex</em> on the state of the Ball. Whoever holds the Mutex is the one who can modify the state therein. This also means that all calculations for game state are split up among all the players, every player only has to run code modifying what they own, which in large scale player events would otherwise increase exponentially with custom scripts for each player’s props or avatars.</p>
</section>
<section id="mastership" class="level4">
<h4 class="anchored" data-anchor-id="mastership">Mastership</h4>
<p>This presents a problem however, how could P2 take the Ball from P1? The solution is Mastership. Whoever is the Master can change who is the Owner at any time. The Master also can change whatever the default Rule is, which is what the Server, and Client references when looking to change Ownership to itself (or someone else?).</p>
<ul>
<li>Ask: Take a round trip to the Master and back to the Server so the Master can decide based on external factors whether or not to allow ownership transfer or deny it. This could be used for example, if someone only wants a gun to be grabbable if they are a “shooter” and not if they are a “civilian”</li>
<li>Deny: You cannot ask for ownership transfer, good for things like Avatar’s transform node, you don’t wanna be involuntarily moved around, or for the root of the world map.</li>
<li>Allow: You can ask for ownership any time, and it is automatically granted.</li>
</ul>
</section>
</section>
<section id="tweaks" class="level3">
<h3 class="anchored" data-anchor-id="tweaks">Tweaks</h3>
<p>We can change the rate of synchronization based on the closest clients owned model, and other things like that, there are a lot of areas for optimization when it comes to using this.</p>
</section>
</section>
<section id="positive-consequences-list" class="level2">
<h2 class="anchored" data-anchor-id="positive-consequences-list">Positive Consequences List</h2>
<ul>
<li>Low Latency for Competitive/Real-Time interactions</li>
<li>Low processing power on both the server and client side</li>
<li>Broad enough to be easily modifiable for optimizations in the future without changing the model</li>
</ul>
</section>
<section id="negative-consequences-list" class="level2">
<h2 class="anchored" data-anchor-id="negative-consequences-list">Negative Consequences List</h2>
<ul>
<li>Complexity, we will have to code this all from scratch basically</li>
<li>Multi-user interactions become impossible on a single object, at least to do simply, some smart coding could get around it but it isn’t easy to do.</li>
<li>Resolutions for the <em>allow</em> rule could lead to inconsistencies, such as two different people picking up a gun and firing it, and two resulting bullets being spawned from the same gun before it gets removed from one individual.</li>
</ul>
</section>
<section id="is-there-a-reason-why-this-should-be-core-and-done-by-us" class="level2">
<h2 class="anchored" data-anchor-id="is-there-a-reason-why-this-should-be-core-and-done-by-us">Is there a reason why this should be core and done by us?</h2>
<p>Absolutely, this is the foundation of basically everything content wise in V-sekai.</p>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References</h2>
<p>https://github.com/V-Sekai/V-Sekai.github.io/blob/master/decisions/2020/20200729-entity-networking.md</p>
<p>Malek’s forum post on networking in the Discord server.</p>
</section>
<section id="derivative-license" class="level2">
<h2 class="anchored" data-anchor-id="derivative-license">Derivative License</h2>
<p>Copyright (c) 2022 V-Sekai contributors.</p>
<p>Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the “Software”), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:</p>
<p>The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.</p>
<p>THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p>


</section>
</section>

 ]]></description>
  <guid>https://v-sekai.github.io/decisions/20221014-networking-overhaul-proposal.html</guid>
  <pubDate>Wed, 30 Nov 2022 17:52:44 GMT</pubDate>
</item>
<item>
  <title></title>
  <link>https://v-sekai.github.io/decisions/20221006-unidot-is-optional.html</link>
  <description><![CDATA[ 



<section id="unidot-is-optional" class="level1">
<h1>Unidot is optional</h1>
<ul>
<li>Status: proposed <!-- draft | rejected | accepted | deprecated | superseded by --></li>
<li>Deciders: V-Sekai,fire,MalekiRe</li>
<li>Tags: V-Sekai,</li>
</ul>
<section id="context-and-problem-statement" class="level2">
<h2 class="anchored" data-anchor-id="context-and-problem-statement">Context and Problem Statement</h2>
<p>Is this error of concerning building Godot Engine with V-Sekai game?</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://v-sekai.github.io/decisions/https:/user-images.githubusercontent.com/32321/194445076-7858161f-9a5b-4a24-81a9-f0710799e1fd.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Unidot addon error</figcaption><p></p>
</figure>
</div>
</section>
<section id="describe-the-proposed-option-and-how-it-helps-to-overcome-the-problem-or-limitation" class="level2">
<h2 class="anchored" data-anchor-id="describe-the-proposed-option-and-how-it-helps-to-overcome-the-problem-or-limitation">Describe the proposed option and how it helps to overcome the problem or limitation</h2>
<p>Let MalekiRe know that the Unidot addon is not critical to V-Sekai game.</p>
</section>
<section id="describe-how-your-proposal-will-work-with-code-pseudo-code-mock-ups-or-diagrams" class="level2">
<h2 class="anchored" data-anchor-id="describe-how-your-proposal-will-work-with-code-pseudo-code-mock-ups-or-diagrams">Describe how your proposal will work, with code, pseudo-code, mock-ups, or diagrams</h2>
<p>Left this document here.</p>
</section>
<section id="positive-consequences" class="level2">
<h2 class="anchored" data-anchor-id="positive-consequences">Positive Consequences <!-- optional --></h2>
<ul>
<li>It’s not essential.</li>
</ul>
</section>
<section id="negative-consequences" class="level2">
<h2 class="anchored" data-anchor-id="negative-consequences">Negative Consequences <!-- optional --></h2>
<ul>
<li>Probably should fix the unidot addon.</li>
</ul>
<p>[this section can be repeated for each option if more than one option is open for consideration]</p>
</section>
<section id="option-graveyard" class="level2">
<h2 class="anchored" data-anchor-id="option-graveyard">Option graveyard: <!-- same as above --></h2>
<ul>
<li>Option: Do something.</li>
<li>Rejection Reason: It’s not essential.</li>
</ul>
</section>
<section id="if-this-enhancement-will-not-be-used-often-can-it-be-worked-around-with-a-few-lines-of-script" class="level2">
<h2 class="anchored" data-anchor-id="if-this-enhancement-will-not-be-used-often-can-it-be-worked-around-with-a-few-lines-of-script">If this enhancement will not be used often, can it be worked around with a few lines of script?</h2>
<p>This is a broken addon.</p>
</section>
<section id="is-there-a-reason-why-this-should-be-core-and-done-by-us" class="level2">
<h2 class="anchored" data-anchor-id="is-there-a-reason-why-this-should-be-core-and-done-by-us">Is there a reason why this should be core and done by us?</h2>
<p>We maintain V-Sekai.</p>
</section>
<section id="derivative-license" class="level2">
<h2 class="anchored" data-anchor-id="derivative-license">Derivative License</h2>
<p>Copyright (c) 2021 V-Sekai contributors.</p>
<p>Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the “Software”), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:</p>
<p>The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.</p>
<p>THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p>


</section>
</section>

 ]]></description>
  <guid>https://v-sekai.github.io/decisions/20221006-unidot-is-optional.html</guid>
  <pubDate>Wed, 30 Nov 2022 17:52:44 GMT</pubDate>
  <media:content url="https://user-images.githubusercontent.com/32321/194445076-7858161f-9a5b-4a24-81a9-f0710799e1fd.png" medium="image" type="image/png"/>
</item>
<item>
  <title></title>
  <link>https://v-sekai.github.io/decisions/20221006-rename-to-main.html</link>
  <description><![CDATA[ 



<section id="rename-master-to-godot3-and-main-to-godot4" class="level1">
<h1>Rename master to godot3 and main to godot4</h1>
<ul>
<li>Status: proposed <!-- draft | rejected | accepted | deprecated | superseded by --></li>
<li>Deciders: V-Sekai,lyuma,fire</li>
<li>Tags: V-Sekai,</li>
</ul>
<section id="context-and-problem-statement" class="level2">
<h2 class="anchored" data-anchor-id="context-and-problem-statement">Context and Problem Statement</h2>
<p>Not all the branches are released and are currently named godot4. They should be renamed to main.</p>
</section>
<section id="describe-the-proposed-option-and-how-it-helps-to-overcome-the-problem-or-limitation" class="level2">
<h2 class="anchored" data-anchor-id="describe-the-proposed-option-and-how-it-helps-to-overcome-the-problem-or-limitation">Describe the proposed option and how it helps to overcome the problem or limitation</h2>
<p>Rename all godot4 branches to be main for v-sekai-game.</p>
</section>
<section id="describe-how-your-proposal-will-work-with-code-pseudo-code-mock-ups-or-diagrams" class="level2">
<h2 class="anchored" data-anchor-id="describe-how-your-proposal-will-work-with-code-pseudo-code-mock-ups-or-diagrams">Describe how your proposal will work, with code, pseudo-code, mock-ups, or diagrams</h2>
<p>iFire (he, him) — Today at 16:11</p>
<p>need some consensus. I think that given v-sekai-game has only one branch it should be named</p>
<p>Lyuma — Today at 16:11</p>
<p>I agree provided we do the same with the submodules</p>
</section>
<section id="positive-consequences" class="level2">
<h2 class="anchored" data-anchor-id="positive-consequences">Positive Consequences <!-- optional --></h2>
<ul>
<li>cohersion</li>
</ul>
</section>
<section id="negative-consequences" class="level2">
<h2 class="anchored" data-anchor-id="negative-consequences">Negative Consequences <!-- optional --></h2>
<ul>
<li>change</li>
</ul>
</section>
<section id="option-graveyard" class="level2">
<h2 class="anchored" data-anchor-id="option-graveyard">Option graveyard: <!-- same as above --></h2>
<ul>
<li>Do nothing.</li>
</ul>
</section>
<section id="if-this-enhancement-will-not-be-used-often-can-it-be-worked-around-with-a-few-lines-of-script" class="level2">
<h2 class="anchored" data-anchor-id="if-this-enhancement-will-not-be-used-often-can-it-be-worked-around-with-a-few-lines-of-script">If this enhancement will not be used often, can it be worked around with a few lines of script?</h2>
<p>Code organization.</p>
</section>
<section id="is-there-a-reason-why-this-should-be-core-and-done-by-us" class="level2">
<h2 class="anchored" data-anchor-id="is-there-a-reason-why-this-should-be-core-and-done-by-us">Is there a reason why this should be core and done by us?</h2>
<p>We own the repos.</p>
</section>
<section id="derivative-license" class="level2">
<h2 class="anchored" data-anchor-id="derivative-license">Derivative License</h2>
<p>Copyright (c) 2021 V-Sekai contributors.</p>
<p>Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the “Software”), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:</p>
<p>The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.</p>
<p>THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p>


</section>
</section>

 ]]></description>
  <guid>https://v-sekai.github.io/decisions/20221006-rename-to-main.html</guid>
  <pubDate>Wed, 30 Nov 2022 17:52:44 GMT</pubDate>
</item>
<item>
  <title></title>
  <link>https://v-sekai.github.io/decisions/20220916-too-many-branches-on-v-sekai-godot.html</link>
  <description><![CDATA[ 



<section id="we-have-too-many-branches-on-v-sekaigodot." class="level1">
<h1>We have too many branches on V-Sekai/godot.</h1>
<section id="context-and-problem-statement" class="level3">
<h3 class="anchored" data-anchor-id="context-and-problem-statement">Context and Problem Statement</h3>
<p>We have too many branches on V-Sekai/godot.</p>
<p>A lot of branches are already merged, some are godot 3.x, some were for old alphas.</p>
</section>
<section id="describe-the-proposed-option-and-how-it-helps-to-overcome-the-problem-or-limitation" class="level3">
<h3 class="anchored" data-anchor-id="describe-the-proposed-option-and-how-it-helps-to-overcome-the-problem-or-limitation">Describe the proposed option and how it helps to overcome the problem or limitation</h3>
<p>Create a procedure for deleting branches.</p>
</section>
<section id="describe-how-your-proposal-will-work-with-code-pseudo-code-mock-ups-or-diagrams" class="level3">
<h3 class="anchored" data-anchor-id="describe-how-your-proposal-will-work-with-code-pseudo-code-mock-ups-or-diagrams">Describe how your proposal will work, with code, pseudo-code, mock-ups, or diagrams</h3>
<p>We should be able to delete merged branches after we remove it from merge script or move the branches to an archive repo with all the PRs.</p>
<p>&lt;lyuma&gt; It’s definitely ok to delete when godot merges . you can still get the commit hash by <code>git log | grep v-sekai/branchname</code> in godotengine/godot.</p>
</section>
<section id="positive-consequences" class="level3">
<h3 class="anchored" data-anchor-id="positive-consequences">Positive Consequences</h3>
<p>Less confusion.</p>
</section>
<section id="negative-consequences" class="level3">
<h3 class="anchored" data-anchor-id="negative-consequences">Negative Consequences</h3>
<p>Accidently deleting a used branch.</p>
</section>
<section id="option-graveyard" class="level3">
<h3 class="anchored" data-anchor-id="option-graveyard">Option graveyard</h3>
<p>Do nothing.</p>
</section>
<section id="if-this-enhancement-will-not-be-used-often-can-it-be-worked-around-with-a-few-lines-of-script" class="level3">
<h3 class="anchored" data-anchor-id="if-this-enhancement-will-not-be-used-often-can-it-be-worked-around-with-a-few-lines-of-script">If this enhancement will not be used often, can it be worked around with a few lines of script?</h3>
<p>Not applicable.</p>
</section>
<section id="is-there-a-reason-why-this-should-be-core-and-done-by-us" class="level3">
<h3 class="anchored" data-anchor-id="is-there-a-reason-why-this-should-be-core-and-done-by-us">Is there a reason why this should be core and done by us?</h3>
<p>We own the V-Sekai/godot repository.</p>
</section>
<section id="references" class="level3">
<h3 class="anchored" data-anchor-id="references">References</h3>
<ul>
<li><a href="https://v-sekai.org/">V-Sekai</a></li>
</ul>
</section>
<section id="license-of-the-contribution" class="level3">
<h3 class="anchored" data-anchor-id="license-of-the-contribution">License of the contribution</h3>
<p>Copyright (c) 2022 V-Sekai contributors.</p>
<p>Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the “Software”), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:</p>
<p>The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.</p>
<p>THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p>


</section>
</section>

 ]]></description>
  <guid>https://v-sekai.github.io/decisions/20220916-too-many-branches-on-v-sekai-godot.html</guid>
  <pubDate>Wed, 30 Nov 2022 17:52:44 GMT</pubDate>
</item>
<item>
  <title></title>
  <link>https://v-sekai.github.io/decisions/20220901-mirror-extend-asset-library-packages.html</link>
  <description><![CDATA[ 



<section id="extended-asset-library-packages-in-addition-to-the-upstream-asset-library" class="level1">
<h1>Extended asset library packages in addition to the upstream asset library</h1>
<section id="context-and-problem-statement" class="level3">
<h3 class="anchored" data-anchor-id="context-and-problem-statement">Context and Problem Statement</h3>
<p>Have a way to deploy custom asset libs via the godot engine asset library ui</p>
</section>
<section id="describe-the-proposed-option-and-how-it-helps-to-overcome-the-problem-or-limitation" class="level3">
<h3 class="anchored" data-anchor-id="describe-the-proposed-option-and-how-it-helps-to-overcome-the-problem-or-limitation">Describe the proposed option and how it helps to overcome the problem or limitation</h3>
<p>We propose to use the V-Sekai uro server to provide an asset library url to Godot Engine.</p>
</section>
<section id="describe-how-your-proposal-will-work-with-code-pseudo-code-mock-ups-or-diagrams" class="level3">
<h3 class="anchored" data-anchor-id="describe-how-your-proposal-will-work-with-code-pseudo-code-mock-ups-or-diagrams">Describe how your proposal will work, with code, pseudo-code, mock-ups, or diagrams</h3>
<p>Implement</p>
<ol type="1">
<li>rest passthrough https://github.com/godotengine/godot-asset-library/blob/master/API.md</li>
<li>account based package bundles (does not include the original package, only the metadata)</li>
</ol>
</section>
<section id="positive-consequences" class="level3">
<h3 class="anchored" data-anchor-id="positive-consequences">Positive Consequences</h3>
<p>We can have our own asset archives.</p>
</section>
<section id="negative-consequences" class="level3">
<h3 class="anchored" data-anchor-id="negative-consequences">Negative Consequences</h3>
<p>May compromise security.</p>
</section>
<section id="option-graveyard" class="level3">
<h3 class="anchored" data-anchor-id="option-graveyard">Option graveyard</h3>
<p>Upload to the asset library directly.</p>
</section>
<section id="if-this-enhancement-will-not-be-used-often-can-it-be-worked-around-with-a-few-lines-of-script" class="level3">
<h3 class="anchored" data-anchor-id="if-this-enhancement-will-not-be-used-often-can-it-be-worked-around-with-a-few-lines-of-script">If this enhancement will not be used often, can it be worked around with a few lines of script?</h3>
<p>Not a few lines of script.</p>
</section>
<section id="is-there-a-reason-why-this-should-be-core-and-done-by-us" class="level3">
<h3 class="anchored" data-anchor-id="is-there-a-reason-why-this-should-be-core-and-done-by-us">Is there a reason why this should be core and done by us?</h3>
<p>We maintain uro.</p>
</section>
<section id="references" class="level3">
<h3 class="anchored" data-anchor-id="references">References</h3>
<ul>
<li><a href="https://v-sekai.org/">V-Sekai</a></li>
</ul>
</section>
<section id="license-of-the-contribution" class="level3">
<h3 class="anchored" data-anchor-id="license-of-the-contribution">License of the contribution</h3>
<p>Copyright (c) 2022 V-Sekai contributors.</p>
<p>Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the “Software”), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:</p>
<p>The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.</p>
<p>THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p>


</section>
</section>

 ]]></description>
  <guid>https://v-sekai.github.io/decisions/20220901-mirror-extend-asset-library-packages.html</guid>
  <pubDate>Wed, 30 Nov 2022 17:52:44 GMT</pubDate>
</item>
<item>
  <title></title>
  <link>https://v-sekai.github.io/decisions/20220830-godot-pdf-workflow.html</link>
  <description><![CDATA[ 



<section id="provide-pdf-reading" class="level1">
<h1>Provide pdf reading</h1>
<section id="context-and-problem-statement" class="level3">
<h3 class="anchored" data-anchor-id="context-and-problem-statement">Context and Problem Statement</h3>
<p>Provide a workflow to read pdf documents.</p>
</section>
<section id="describe-the-proposed-option-and-how-it-helps-to-overcome-the-problem-or-limitation" class="level3">
<h3 class="anchored" data-anchor-id="describe-the-proposed-option-and-how-it-helps-to-overcome-the-problem-or-limitation">Describe the proposed option and how it helps to overcome the problem or limitation</h3>
<p>We want to provide pdf reading without implementing a pdf reader.</p>
</section>
<section id="describe-how-your-proposal-will-work-with-code-pseudo-code-mock-ups-or-diagrams" class="level3">
<h3 class="anchored" data-anchor-id="describe-how-your-proposal-will-work-with-code-pseudo-code-mock-ups-or-diagrams">Describe how your proposal will work, with code, pseudo-code, mock-ups, or diagrams</h3>
<ol type="1">
<li>Convert pdf into a series of svgs (raster + vector)</li>
<li>Put svgs in a folder</li>
<li>Clean with https://github.com/RazrFalcon/svgcleaner</li>
<li>Use godot engine 4’s thorvg</li>
</ol>
</section>
<section id="positive-consequences" class="level3">
<h3 class="anchored" data-anchor-id="positive-consequences">Positive Consequences</h3>
<p>Can import artwork.</p>
</section>
<section id="negative-consequences" class="level3">
<h3 class="anchored" data-anchor-id="negative-consequences">Negative Consequences</h3>
<p>Not a real pdf viewer.</p>
</section>
<section id="option-graveyard" class="level3">
<h3 class="anchored" data-anchor-id="option-graveyard">Option graveyard</h3>
<p>Do nothing.</p>
</section>
<section id="if-this-enhancement-will-not-be-used-often-can-it-be-worked-around-with-a-few-lines-of-script" class="level3">
<h3 class="anchored" data-anchor-id="if-this-enhancement-will-not-be-used-often-can-it-be-worked-around-with-a-few-lines-of-script">If this enhancement will not be used often, can it be worked around with a few lines of script?</h3>
<p>A few lines of cli.</p>
</section>
<section id="is-there-a-reason-why-this-should-be-core-and-done-by-us" class="level3">
<h3 class="anchored" data-anchor-id="is-there-a-reason-why-this-should-be-core-and-done-by-us">Is there a reason why this should be core and done by us?</h3>
<p>Wanted to write the workflow down.</p>
</section>
<section id="references" class="level3">
<h3 class="anchored" data-anchor-id="references">References</h3>
<ul>
<li><a href="https://v-sekai.org/">V-Sekai</a></li>
</ul>
</section>
<section id="license-of-the-contribution" class="level3">
<h3 class="anchored" data-anchor-id="license-of-the-contribution">License of the contribution</h3>
<p>Copyright (c) 2022 V-Sekai contributors.</p>
<p>Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the “Software”), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:</p>
<p>The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.</p>
<p>THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p>


</section>
</section>

 ]]></description>
  <guid>https://v-sekai.github.io/decisions/20220830-godot-pdf-workflow.html</guid>
  <pubDate>Wed, 30 Nov 2022 17:52:44 GMT</pubDate>
</item>
<item>
  <title></title>
  <link>https://v-sekai.github.io/decisions/20220820-market-booth-tutorial.html</link>
  <description><![CDATA[ 



<section id="make-a-market-booth-creation-tutorial." class="level1">
<h1>Make a market booth creation tutorial.</h1>
<section id="context-and-problem-statement" class="level3">
<h3 class="anchored" data-anchor-id="context-and-problem-statement">Context and Problem Statement</h3>
<p>To present at various virtual market locations, we need to do various workflow steps that are quickly forgotten.</p>
</section>
<section id="describe-the-proposed-option-and-how-it-helps-to-overcome-the-problem-or-limitation" class="level3">
<h3 class="anchored" data-anchor-id="describe-the-proposed-option-and-how-it-helps-to-overcome-the-problem-or-limitation">Describe the proposed option and how it helps to overcome the problem or limitation</h3>
<p>We can write down our collective workflows for creation.</p>
</section>
<section id="describe-how-your-proposal-will-work-with-code-pseudo-code-mock-ups-or-diagrams" class="level3">
<h3 class="anchored" data-anchor-id="describe-how-your-proposal-will-work-with-code-pseudo-code-mock-ups-or-diagrams">Describe how your proposal will work, with code, pseudo-code, mock-ups, or diagrams</h3>
<p>Write a guide to makie a 3d market booth that is the <code>4m x 4m x 5m</code> standard size and <code>2m x 2m x 2.5m</code> constrained size.</p>
</section>
<section id="tools-used" class="level2">
<h2 class="anchored" data-anchor-id="tools-used">Tools used</h2>
<ol type="1">
<li>Substance designer</li>
<li>Blender</li>
</ol>
</section>
<section id="initial-task" class="level2">
<h2 class="anchored" data-anchor-id="initial-task">Initial task</h2>
<ol type="1">
<li>Make a procedural grid texture and some text.</li>
<li>Put the booth in blender on the booth boundaries (cube).</li>
</ol>
</section>
<section id="storage" class="level2">
<h2 class="anchored" data-anchor-id="storage">Storage</h2>
<ol type="1">
<li>Upload to Github organization.</li>
</ol>
<section id="positive-consequences" class="level3">
<h3 class="anchored" data-anchor-id="positive-consequences">Positive Consequences</h3>
<ol type="1">
<li>Increase our workflow</li>
</ol>
</section>
<section id="negative-consequences" class="level3">
<h3 class="anchored" data-anchor-id="negative-consequences">Negative Consequences</h3>
<ol type="1">
<li>Loss of creativity</li>
</ol>
</section>
<section id="option-graveyard" class="level3">
<h3 class="anchored" data-anchor-id="option-graveyard">Option graveyard</h3>
<ul>
<li>Option: Recreate the workflow from scratch</li>
</ul>
</section>
<section id="if-this-enhancement-will-not-be-used-often-can-it-be-worked-around-with-a-few-lines-of-script" class="level3">
<h3 class="anchored" data-anchor-id="if-this-enhancement-will-not-be-used-often-can-it-be-worked-around-with-a-few-lines-of-script">If this enhancement will not be used often, can it be worked around with a few lines of script?</h3>
<p>Workflow enhancement.</p>
</section>
<section id="is-there-a-reason-why-this-should-be-core-and-done-by-us" class="level3">
<h3 class="anchored" data-anchor-id="is-there-a-reason-why-this-should-be-core-and-done-by-us">Is there a reason why this should be core and done by us?</h3>
<p>We are doing this, so we can record how we did it.</p>
</section>
<section id="references" class="level3">
<h3 class="anchored" data-anchor-id="references">References</h3>
<ul>
<li><a href="https://v-sekai.org/">V-Sekai</a></li>
<li>https://www.youtube.com/watch?v=LGZWjyeUPHU</li>
</ul>
</section>
<section id="license-of-the-contribution" class="level3">
<h3 class="anchored" data-anchor-id="license-of-the-contribution">License of the contribution</h3>
<p>Copyright (c) 2022 V-Sekai contributors.</p>
<p>Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the “Software”), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:</p>
<p>The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.</p>
<p>THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p>


</section>
</section>
</section>

 ]]></description>
  <guid>https://v-sekai.github.io/decisions/20220820-market-booth-tutorial.html</guid>
  <pubDate>Wed, 30 Nov 2022 17:52:44 GMT</pubDate>
</item>
<item>
  <title></title>
  <link>https://v-sekai.github.io/decisions/20220820-cloth-sim.html</link>
  <description><![CDATA[ 



<section id="simulate-cloth-on-characters" class="level1">
<h1>Simulate cloth on characters</h1>
<p><strong>Labels</strong>: <code>enhancement</code></p>
<section id="context-and-problem-statement" class="level3">
<h3 class="anchored" data-anchor-id="context-and-problem-statement">Context and Problem Statement</h3>
<p>We want to simulate clothing on characters without wardrobe malfunction.</p>
</section>
<section id="describe-the-proposed-option-and-how-it-helps-to-overcome-the-problem-or-limitation" class="level3">
<h3 class="anchored" data-anchor-id="describe-the-proposed-option-and-how-it-helps-to-overcome-the-problem-or-limitation">Describe the proposed option and how it helps to overcome the problem or limitation</h3>
<p>Use opensource tooling to accomplish this.</p>
</section>
<section id="describe-how-your-proposal-will-work-with-code-pseudo-code-mock-ups-or-diagrams" class="level3">
<h3 class="anchored" data-anchor-id="describe-how-your-proposal-will-work-with-code-pseudo-code-mock-ups-or-diagrams">Describe how your proposal will work, with code, pseudo-code, mock-ups, or diagrams</h3>
<p>Run conditioner on inputs. https://github.com/fire/preconditioner-for-cloth-and-deformable-body-simulation</p>
</section>
<section id="positive-consequences" class="level3">
<h3 class="anchored" data-anchor-id="positive-consequences">Positive Consequences</h3>
<p>Can have clothing.</p>
</section>
<section id="negative-consequences" class="level3">
<h3 class="anchored" data-anchor-id="negative-consequences">Negative Consequences</h3>
<p>Can have clothing.</p>
</section>
<section id="option-graveyard" class="level3">
<h3 class="anchored" data-anchor-id="option-graveyard">Option graveyard</h3>
<p><em>No response</em></p>
</section>
<section id="if-this-enhancement-will-not-be-used-often-can-it-be-worked-around-with-a-few-lines-of-script" class="level3">
<h3 class="anchored" data-anchor-id="if-this-enhancement-will-not-be-used-often-can-it-be-worked-around-with-a-few-lines-of-script">If this enhancement will not be used often, can it be worked around with a few lines of script?</h3>
<p>Not trivial.</p>
</section>
<section id="is-there-a-reason-why-this-should-be-core-and-done-by-us" class="level3">
<h3 class="anchored" data-anchor-id="is-there-a-reason-why-this-should-be-core-and-done-by-us">Is there a reason why this should be core and done by us?</h3>
<p>Trying out a test.</p>
</section>
<section id="references" class="level3">
<h3 class="anchored" data-anchor-id="references">References</h3>
<ul>
<li><a href="https://v-sekai.org/">V-Sekai</a></li>
</ul>
</section>
<section id="license-of-the-contribution" class="level3">
<h3 class="anchored" data-anchor-id="license-of-the-contribution">License of the contribution</h3>
<p>Copyright (c) 2022 V-Sekai contributors.</p>
<p>Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the “Software”), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:</p>
<p>The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.</p>
<p>THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p>


</section>
</section>

 ]]></description>
  <guid>https://v-sekai.github.io/decisions/20220820-cloth-sim.html</guid>
  <pubDate>Wed, 30 Nov 2022 17:52:44 GMT</pubDate>
</item>
<item>
  <title></title>
  <link>https://v-sekai.github.io/decisions/20220820-bake alembic-anim-via-blender.html</link>
  <description><![CDATA[ 



<section id="bake-alembic-imports-by-running-blender-script." class="level1">
<h1>Bake alembic imports by running blender script.</h1>
<section id="context-and-problem-statement" class="level3">
<h3 class="anchored" data-anchor-id="context-and-problem-statement">Context and Problem Statement</h3>
<p>Want to bake alembic imports to gltf blend shapes.</p>
</section>
<section id="describe-the-proposed-option-and-how-it-helps-to-overcome-the-problem-or-limitation" class="level3">
<h3 class="anchored" data-anchor-id="describe-the-proposed-option-and-how-it-helps-to-overcome-the-problem-or-limitation">Describe the proposed option and how it helps to overcome the problem or limitation</h3>
<p>We run a python script in Blender to bake alembic inputs to gltf2.</p>
</section>
<section id="describe-how-your-proposal-will-work-with-code-pseudo-code-mock-ups-or-diagrams" class="level3">
<h3 class="anchored" data-anchor-id="describe-how-your-proposal-will-work-with-code-pseudo-code-mock-ups-or-diagrams">Describe how your proposal will work, with code, pseudo-code, mock-ups, or diagrams</h3>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="co" style="color: #5E5E5E;"># MIT LICENSE</span></span>
<span id="cb1-2"><span class="co" style="color: #5E5E5E;"># Authored by iFire#6518 and alexfreyre#1663</span></span>
<span id="cb1-3"><span class="co" style="color: #5E5E5E;"># This code ONLY apply to a mesh and simulations with ONLY the same vertex number</span></span>
<span id="cb1-4"></span>
<span id="cb1-5"><span class="im" style="color: #00769E;">import</span> bpy</span>
<span id="cb1-6"></span>
<span id="cb1-7"><span class="co" style="color: #5E5E5E;">#Converts a MeshCache or Cloth modifiers to ShapeKeys</span></span>
<span id="cb1-8">frame <span class="op" style="color: #5E5E5E;">=</span> bpy.context.scene.frame_start</span>
<span id="cb1-9"><span class="cf" style="color: #003B4F;">for</span> frame <span class="kw" style="color: #003B4F;">in</span> <span class="bu" style="color: null;">range</span>(bpy.context.scene.frame_end <span class="op" style="color: #5E5E5E;">+</span> <span class="dv" style="color: #AD0000;">1</span>):</span>
<span id="cb1-10">    bpy.context.scene.frame_current <span class="op" style="color: #5E5E5E;">=</span> frame</span>
<span id="cb1-11"></span>
<span id="cb1-12">    <span class="co" style="color: #5E5E5E;"># For alembic files converted to MDD and loaded as MeshCache.</span></span>
<span id="cb1-13">    bpy.ops.<span class="bu" style="color: null;">object</span>.modifier_apply_as_shapekey(keep_modifier<span class="op" style="color: #5E5E5E;">=</span><span class="va" style="color: #111111;">True</span>, modifier<span class="op" style="color: #5E5E5E;">=</span><span class="st" style="color: #20794D;">"MeshCache"</span>)</span>
<span id="cb1-14"></span>
<span id="cb1-15">    <span class="co" style="color: #5E5E5E;"># For cloth simulations inside blender using a Cloth modifier.</span></span>
<span id="cb1-16">    <span class="co" style="color: #5E5E5E;">#bpy.ops.object.modifier_apply_as_shapekey(keep_modifier=True, modifier="Cloth")</span></span>
<span id="cb1-17"></span>
<span id="cb1-18"><span class="co" style="color: #5E5E5E;"># Loop through shapekeys and add as keyframe per frame.</span></span>
<span id="cb1-19"><span class="co" style="color: #5E5E5E;"># https://blender.stackexchange.com/q/149045/87258</span></span>
<span id="cb1-20">frame <span class="op" style="color: #5E5E5E;">=</span> bpy.context.scene.frame_start</span>
<span id="cb1-21"><span class="cf" style="color: #003B4F;">for</span> frame <span class="kw" style="color: #003B4F;">in</span> <span class="bu" style="color: null;">range</span>(bpy.context.scene.frame_end <span class="op" style="color: #5E5E5E;">+</span> <span class="dv" style="color: #AD0000;">1</span>):</span>
<span id="cb1-22">    bpy.context.scene.frame_current <span class="op" style="color: #5E5E5E;">=</span> frame</span>
<span id="cb1-23"></span>
<span id="cb1-24">    <span class="cf" style="color: #003B4F;">for</span> shapekey <span class="kw" style="color: #003B4F;">in</span> bpy.data.shape_keys:</span>
<span id="cb1-25">        <span class="cf" style="color: #003B4F;">for</span> i, keyblock <span class="kw" style="color: #003B4F;">in</span> <span class="bu" style="color: null;">enumerate</span>(shapekey.key_blocks):</span>
<span id="cb1-26">            <span class="cf" style="color: #003B4F;">if</span> keyblock.name <span class="op" style="color: #5E5E5E;">!=</span> <span class="st" style="color: #20794D;">"Basis"</span>:</span>
<span id="cb1-27">                curr <span class="op" style="color: #5E5E5E;">=</span> i <span class="op" style="color: #5E5E5E;">-</span> <span class="dv" style="color: #AD0000;">1</span></span>
<span id="cb1-28">                <span class="cf" style="color: #003B4F;">if</span> curr <span class="op" style="color: #5E5E5E;">!=</span> frame:</span>
<span id="cb1-29">                    keyblock.value <span class="op" style="color: #5E5E5E;">=</span> <span class="dv" style="color: #AD0000;">0</span></span>
<span id="cb1-30">                    keyblock.keyframe_insert(<span class="st" style="color: #20794D;">"value"</span>, frame<span class="op" style="color: #5E5E5E;">=</span>frame)</span>
<span id="cb1-31">                <span class="cf" style="color: #003B4F;">else</span>:</span>
<span id="cb1-32">                    keyblock.value <span class="op" style="color: #5E5E5E;">=</span> <span class="dv" style="color: #AD0000;">1</span></span>
<span id="cb1-33">                    keyblock.keyframe_insert(<span class="st" style="color: #20794D;">"value"</span>, frame<span class="op" style="color: #5E5E5E;">=</span>frame)</span>
<span id="cb1-34"></span>
<span id="cb1-35"><span class="co" style="color: #5E5E5E;"># bpy.ops.object.modifier_remove(modifier="MeshCache")</span></span>
<span id="cb1-36"><span class="co" style="color: #5E5E5E;"># bpy.ops.object.modifier_remove(modifier="Cloth")</span></span></code></pre></div>
<p>Do not use the pc2 vertex cache format because of mesh accuracy loss.</p>
</section>
<section id="positive-consequences" class="level3">
<h3 class="anchored" data-anchor-id="positive-consequences">Positive Consequences</h3>
<p>Can convert alembic to gltf2 for better interoperability.</p>
</section>
<section id="negative-consequences" class="level3">
<h3 class="anchored" data-anchor-id="negative-consequences">Negative Consequences</h3>
<p>Blend shapes are big.</p>
</section>
<section id="option-graveyard" class="level3">
<h3 class="anchored" data-anchor-id="option-graveyard">Option graveyard</h3>
<p>Option: Don’t convert.</p>
<p>This loses the animation.</p>
</section>
<section id="if-this-enhancement-will-not-be-used-often-can-it-be-worked-around-with-a-few-lines-of-script" class="level3">
<h3 class="anchored" data-anchor-id="if-this-enhancement-will-not-be-used-often-can-it-be-worked-around-with-a-few-lines-of-script">If this enhancement will not be used often, can it be worked around with a few lines of script?</h3>
<p>Not a few lines of script.</p>
</section>
<section id="is-there-a-reason-why-this-should-be-core-and-done-by-us" class="level3">
<h3 class="anchored" data-anchor-id="is-there-a-reason-why-this-should-be-core-and-done-by-us">Is there a reason why this should be core and done by us?</h3>
<p>We already made a solution.</p>
</section>
<section id="references" class="level3">
<h3 class="anchored" data-anchor-id="references">References</h3>
<ul>
<li><a href="https://v-sekai.org/">V-Sekai</a></li>
</ul>
</section>
<section id="license-of-the-contribution" class="level3">
<h3 class="anchored" data-anchor-id="license-of-the-contribution">License of the contribution</h3>
<p>Copyright (c) 2022 V-Sekai contributors.</p>
<p>Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the “Software”), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:</p>
<p>The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.</p>
<p>THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p>


</section>
</section>

 ]]></description>
  <guid>https://v-sekai.github.io/decisions/20220820-bake alembic-anim-via-blender.html</guid>
  <pubDate>Wed, 30 Nov 2022 17:52:44 GMT</pubDate>
</item>
<item>
  <title></title>
  <link>https://v-sekai.github.io/decisions/20220624-webcam-to-posed-characters.html</link>
  <description><![CDATA[ 



<section id="connect-mediapipe-to-blender" class="level3">
<h3 class="anchored" data-anchor-id="connect-mediapipe-to-blender">Connect Mediapipe to Blender</h3>
</section>
<section id="context-and-problem-statement" class="level3">
<h3 class="anchored" data-anchor-id="context-and-problem-statement">Context and Problem Statement</h3>
<p>Want to animate a blender file with mediapipe</p>
</section>
<section id="describe-the-feature-enhancement-and-how-it-helps-to-overcome-the-problem-or-limitation" class="level3">
<h3 class="anchored" data-anchor-id="describe-the-feature-enhancement-and-how-it-helps-to-overcome-the-problem-or-limitation">Describe the feature / enhancement and how it helps to overcome the problem or limitation</h3>
<p>By writing a c++ executable on Linux, we can connect Mediapipe to Blender.</p>
</section>
<section id="describe-how-your-proposal-will-work-with-code-pseudo-code-mock-ups-andor-diagrams" class="level3">
<h3 class="anchored" data-anchor-id="describe-how-your-proposal-will-work-with-code-pseudo-code-mock-ups-andor-diagrams">Describe how your proposal will work, with code, pseudo-code, mock-ups, and/or diagrams</h3>
<ol type="1">
<li>Create a wrapper for https://github.com/infosia/vmc2bvh/tree/master/osc</li>
<li>Install Blender addon https://github.com/maybites/blender.NodeOSC</li>
<li>Convert python script to c++</li>
<li>Make c++ buildable by bazel</li>
<li>Build executables on Github Actions</li>
</ol>
<section id="design-loop" class="level4">
<h4 class="anchored" data-anchor-id="design-loop">Design loop</h4>
<ol type="1">
<li>https://github.com/CLIUtils/CLI11 for command line parsing</li>
<li>https://github.com/infosia/vmc2bvh/blob/master/code/Vmc2Bvh.cpp for example code</li>
<li>For each process send osc to node osc (Blender).</li>
<li>Create a structure for the messages</li>
</ol>
</section>
<section id="notes-from-lox" class="level4">
<h4 class="anchored" data-anchor-id="notes-from-lox">Notes from Lox</h4>
<p>I looked at your mediapipe code.</p>
<p>I can write pseudocode but since i don’t have a cpp toolchain, i cant guarantee it’ll work</p>
<p>You might take a look at my code</p>
<p>https://gitlab.com/-/snippets/2349711#LC70</p>
<p>The idea is quite simple:</p>
<pre><code>compute hips and chest 3d position by averaging left+right hips and left+right shoulders 3d landmark.
compute hips and chest 2d position similarly using 2d landmark.
compute the spine length as the hips-chest distance for both 3d and 2d.
the 2d-to-3d scale factor is then the ratio of the two distances.
hips world position will be hips 2d position scaled by the factor, with z=0</code></pre>
<p>how do I get the 3d landmarks</p>
<p>that’s provided by API https://google.github.io/mediapipe/solutions/pose#pose_world_landmarks</p>
<p>lox9973 — Today at 01:26</p>
<p>2d landmarks: output.pose_landmarks</p>
<p>3d landmarks: output.pose_world_landmarks</p>
<p>they are both 4d vectors</p>
</section>
</section>
<section id="if-this-enhancement-will-not-be-used-often-can-it-be-worked-around-with-a-few-lines-of-script" class="level3">
<h3 class="anchored" data-anchor-id="if-this-enhancement-will-not-be-used-often-can-it-be-worked-around-with-a-few-lines-of-script">If this enhancement will not be used often, can it be worked around with a few lines of script?</h3>
<p>ML and armature work is hard</p>
</section>
<section id="positive-consequences" class="level3">
<h3 class="anchored" data-anchor-id="positive-consequences">Positive Consequences</h3>
<p><em>No response</em></p>
</section>
<section id="negative-consequences" class="level3">
<h3 class="anchored" data-anchor-id="negative-consequences">Negative Consequences</h3>
<p><em>No response</em></p>
</section>
<section id="is-there-a-reason-why-this-should-be-core-and-done-by-us" class="level3">
<h3 class="anchored" data-anchor-id="is-there-a-reason-why-this-should-be-core-and-done-by-us">Is there a reason why this should be core and done by us?</h3>
<p>It’s needed for face tracking to work well.</p>
</section>
<section id="references" class="level3">
<h3 class="anchored" data-anchor-id="references">References</h3>
<p>From Kendrick</p>
<ul>
<li><a href="https://github.com/V-Sekai/v-sekai-proposals/files/6972400/media_pipe_demo.zip">media_pipe_demo.zip</a></li>
<li>https://github.com/V-Sekai/game-tools-V-Sekai</li>
</ul>
</section>
<section id="derivative-license" class="level3">
<h3 class="anchored" data-anchor-id="derivative-license">Derivative License</h3>
<p>Copyright (c) 2020-2021 V-Sekai contributors.</p>
<p>Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the “Software”), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:</p>
<p>The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.</p>
<p>THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p>


</section>

 ]]></description>
  <guid>https://v-sekai.github.io/decisions/20220624-webcam-to-posed-characters.html</guid>
  <pubDate>Wed, 30 Nov 2022 17:52:44 GMT</pubDate>
</item>
<item>
  <title></title>
  <link>https://v-sekai.github.io/decisions/20220605-host-internal-baserow.html</link>
  <description><![CDATA[ 



<section id="host-a-baserow-application-for-internal-use." class="level1">
<h1>Host a baserow application for internal use.</h1>
<section id="describe-the-status-of-the-issue." class="level3">
<h3 class="anchored" data-anchor-id="describe-the-status-of-the-issue.">Describe the status of the issue.</h3>
<ul class="task-list">
<li><input type="checkbox" disabled="" checked="">proposed</li>
<li><input type="checkbox" disabled="" checked="">draft</li>
<li><input type="checkbox" disabled="">rejected</li>
<li><input type="checkbox" disabled="">accepted</li>
<li><input type="checkbox" disabled="">deprecated</li>
<li><input type="checkbox" disabled="">superseded by</li>
</ul>
</section>
<section id="list-the-deciders-of-the-issue." class="level3">
<h3 class="anchored" data-anchor-id="list-the-deciders-of-the-issue.">List the deciders of the issue.</h3>
<p>V-Sekai,fire</p>
</section>
<section id="describe-the-tags-of-the-issue." class="level3">
<h3 class="anchored" data-anchor-id="describe-the-tags-of-the-issue.">Describe the tags of the issue.</h3>
<p>V-Sekai,</p>
</section>
<section id="context-and-problem-statement" class="level3">
<h3 class="anchored" data-anchor-id="context-and-problem-statement">Context and Problem Statement</h3>
<p>I want to store adjacent information related to V-Sekai in a database.</p>
</section>
<section id="describe-the-proposed-option-and-how-it-helps-to-overcome-the-problem-or-limitation" class="level3">
<h3 class="anchored" data-anchor-id="describe-the-proposed-option-and-how-it-helps-to-overcome-the-problem-or-limitation">Describe the proposed option and how it helps to overcome the problem or limitation</h3>
<p>Add a digital ocean apps config.</p>
<p>https://www.digitalocean.com/products/app-platform</p>
<p>Features:</p>
<ol type="1">
<li>managed postgresql database</li>
<li>no managed redis</li>
<li>digital ocean spaces</li>
<li>apps platform</li>
</ol>
<pre><code>databases:
- engine: PG
  name: baserow-db
  num_nodes: 1
  size: basic-xs
  version: "12"
name: chibifire-base
region: tor
services:
- envs:
  - key: BASEROW_PUBLIC_URL
    scope: RUN_AND_BUILD_TIME
    value: https://${APP_DOMAIN}
  - key: DATABASE_URL
    scope: RUN_AND_BUILD_TIME
    value: postgresql://${baserow-db.USERNAME}:${baserow-db.PASSWORD}@${baserow-db.HOSTNAME}:${baserow-db.PORT}/${baserow-db.DATABASE}
  - key: AWS_ACCESS_KEY_ID
    scope: RUN_AND_BUILD_TIME
    value: AWS_ACCESS_KEY_ID_AWS_ACCESS_KEY_ID
  - key: AWS_S3_ENDPOINT_URL
    scope: RUN_AND_BUILD_TIME
    value: https://sfo3.digitaloceanspaces.com
  - key: AWS_S3_CUSTOM_DOMAIN
    scope: RUN_AND_BUILD_TIME
    value: 'chibifire.sfo3.digitaloceanspaces.com '
  - key: AWS_S3_REGION_NAME
    scope: RUN_AND_BUILD_TIME
    value: sfo3
  - key: AWS_STORAGE_BUCKET_NAME
    scope: RUN_AND_BUILD_TIME
    value: chibifire
  - key: AWS_SECRET_ACCESS_KEY
    scope: RUN_AND_BUILD_TIME
    type: SECRET
    value: SECRETSECRETSECRET
    scope: RUN_AND_BUILD_TIME
    value: "true"
  - key: SYNC_TEMPLATES_ON_STARTUP
    scope: RUN_AND_BUILD_TIME
    value: "false"
  - key: PRIVATE_BACKEND_URL
    scope: RUN_AND_BUILD_TIME
    value: ${_self.PRIVATE_URL}
  http_port: 80
  image:
    registry: baserow
    registry_type: DOCKER_HUB
    repository: baserow
    tag: 1.10.2
  instance_count: 1
  instance_size_slug: basic-xs
  name: baserow-baserow
  routes:
  - path: /
</code></pre>
</section>
<section id="positive-consequences" class="level3">
<h3 class="anchored" data-anchor-id="positive-consequences">Positive Consequences</h3>
<p>I can finally store things.</p>
</section>
<section id="negative-consequences" class="level3">
<h3 class="anchored" data-anchor-id="negative-consequences">Negative Consequences</h3>
<p>Pay for the baserow service.</p>
</section>
<section id="option-graveyard" class="level3">
<h3 class="anchored" data-anchor-id="option-graveyard">Option graveyard</h3>
<ul>
<li>Rejected using premium saas from baserow</li>
<li>Rejected using airtable</li>
</ul>
</section>
<section id="if-this-enhancement-will-not-be-used-often-can-it-be-worked-around-with-a-few-lines-of-script" class="level3">
<h3 class="anchored" data-anchor-id="if-this-enhancement-will-not-be-used-often-can-it-be-worked-around-with-a-few-lines-of-script">If this enhancement will not be used often, can it be worked around with a few lines of script?</h3>
<p>Not a few lines of code, but fairly simple.</p>
</section>
<section id="is-there-a-reason-why-this-should-be-core-and-done-by-us" class="level3">
<h3 class="anchored" data-anchor-id="is-there-a-reason-why-this-should-be-core-and-done-by-us">Is there a reason why this should be core and done by us?</h3>
<p>I need to store things.</p>
</section>
<section id="references" class="level3">
<h3 class="anchored" data-anchor-id="references">References</h3>
<ul>
<li><a href="https://v-sekai.org/">V-Sekai</a></li>
<li><a href="https://gitlab.com/bramw/baserow/-/issues/998">Create digital ocean instructions</a></li>
</ul>
</section>
<section id="license-of-the-contribution" class="level3">
<h3 class="anchored" data-anchor-id="license-of-the-contribution">License of the contribution</h3>
<p>Copyright (c) 2022 V-Sekai contributors.</p>
<p>Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the “Software”), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:</p>
<p>The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.</p>
<p>THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p>


</section>
</section>

 ]]></description>
  <guid>https://v-sekai.github.io/decisions/20220605-host-internal-baserow.html</guid>
  <pubDate>Wed, 30 Nov 2022 17:52:44 GMT</pubDate>
</item>
<item>
  <title></title>
  <link>https://v-sekai.github.io/decisions/20220605-gocd-pipeline-reset.html</link>
  <description><![CDATA[ 



<section id="to-avoid-git-submodule-but-recreate-the-gocd-pipelines" class="level1">
<h1>To avoid git submodule but recreate the gocd pipelines</h1>
<section id="describe-the-status-of-the-issue." class="level3">
<h3 class="anchored" data-anchor-id="describe-the-status-of-the-issue.">Describe the status of the issue.</h3>
<ul class="task-list">
<li><input type="checkbox" disabled="" checked="">proposed</li>
<li><input type="checkbox" disabled="" checked="">draft</li>
<li><input type="checkbox" disabled="">rejected</li>
<li><input type="checkbox" disabled="" checked="">accepted</li>
<li><input type="checkbox" disabled="">deprecated</li>
<li><input type="checkbox" disabled="">superseded by</li>
</ul>
</section>
<section id="list-the-deciders-of-the-issue." class="level3">
<h3 class="anchored" data-anchor-id="list-the-deciders-of-the-issue.">List the deciders of the issue.</h3>
<p>V-Sekai,fire,</p>
</section>
<section id="describe-the-tags-of-the-issue." class="level3">
<h3 class="anchored" data-anchor-id="describe-the-tags-of-the-issue.">Describe the tags of the issue.</h3>
<p>V-Sekai,gocd,</p>
</section>
<section id="context-and-problem-statement" class="level3">
<h3 class="anchored" data-anchor-id="context-and-problem-statement">Context and Problem Statement</h3>
<p>Gocd git submodule failed to load.</p>
</section>
<section id="describe-the-proposed-option-and-how-it-helps-to-overcome-the-problem-or-limitation" class="level3">
<h3 class="anchored" data-anchor-id="describe-the-proposed-option-and-how-it-helps-to-overcome-the-problem-or-limitation">Describe the proposed option and how it helps to overcome the problem or limitation</h3>
<p>Reset the gocd pipeline by renaming the initial pipeline name.</p>
</section>
<section id="describe-how-your-proposal-will-work-with-code-pseudo-code-mock-ups-or-diagrams" class="level3">
<h3 class="anchored" data-anchor-id="describe-how-your-proposal-will-work-with-code-pseudo-code-mock-ups-or-diagrams">Describe how your proposal will work, with code, pseudo-code, mock-ups, or diagrams</h3>
<ol type="1">
<li>clone https://github.com/V-Sekai/groups-gocd-pipelines</li>
<li>Modify https://github.com/V-Sekai/groups-gocd-pipelines/blob/master/src/godot_4_x.jsonnet</li>
<li>godot_template_groups_editor to have increment the revision number.</li>
<li>./bin/generate</li>
<li>commit to git</li>
</ol>
</section>
<section id="positive-consequences" class="level3">
<h3 class="anchored" data-anchor-id="positive-consequences">Positive Consequences</h3>
<p>Able to build again.</p>
</section>
<section id="negative-consequences" class="level3">
<h3 class="anchored" data-anchor-id="negative-consequences">Negative Consequences</h3>
<p>Increases cache size.</p>
</section>
<section id="option-graveyard" class="level3">
<h3 class="anchored" data-anchor-id="option-graveyard">Option graveyard</h3>
<p><em>No response</em></p>
</section>
<section id="if-this-enhancement-will-not-be-used-often-can-it-be-worked-around-with-a-few-lines-of-script" class="level3">
<h3 class="anchored" data-anchor-id="if-this-enhancement-will-not-be-used-often-can-it-be-worked-around-with-a-few-lines-of-script">If this enhancement will not be used often, can it be worked around with a few lines of script?</h3>
<p>It is a few lines of script.</p>
</section>
<section id="is-there-a-reason-why-this-should-be-core-and-done-by-us" class="level3">
<h3 class="anchored" data-anchor-id="is-there-a-reason-why-this-should-be-core-and-done-by-us">Is there a reason why this should be core and done by us?</h3>
<p>It’s our release process.</p>
</section>
<section id="references" class="level3">
<h3 class="anchored" data-anchor-id="references">References</h3>
<ul>
<li><a href="https://v-sekai.org/">V-Sekai</a></li>
</ul>
</section>
<section id="license-of-the-contribution" class="level3">
<h3 class="anchored" data-anchor-id="license-of-the-contribution">License of the contribution</h3>
<p>Copyright (c) 2022 V-Sekai contributors.</p>
<p>Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the “Software”), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:</p>
<p>The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.</p>
<p>THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p>


</section>
</section>

 ]]></description>
  <guid>https://v-sekai.github.io/decisions/20220605-gocd-pipeline-reset.html</guid>
  <pubDate>Wed, 30 Nov 2022 17:52:44 GMT</pubDate>
</item>
</channel>
</rss>
