# Proposed: Evaluate three proposals for V-Sekai content distribution

## The Context

In addressing the security concerns related to the V-Sekai content distribution, we are focusing on several key issues including the sandbox API surface, file size management, resource loading, and packed scene instantiation.

## The Problem Statement

Our goal is to safely initialize a chair from the V-Sekai content distribution network into the virtual world without compromising security or performance.

## Describe how your proposal will work with code, pseudo-code, mock-ups, or diagrams

### Option 1: Instantiate and Validate binary PackedScene

This method involves loading chunks of an average packed scene from the web, instantiating it in the sandbox, and apply runtime verification. This approach prevents the double initializer security concern and avoids using triple the memory to copy the PackedScene.

#### Double initializer security concern

The drift between different content initiatilzers, which becomes a security problem where code has drifted and fixes are lost.

### Option 2: Instantiate and Validate binary GLTF

For this option, we would stream an average glTF file from the web and develop a loader for glTF within the Godot sandbox equipped with a set of verifiers. We would need to create custom VSEKAI or GODOT extensions for each unspecified resource and node type, though simple schemas could be autogenerated from classes. We wish to enable Godot to load older content seamlessly.

### Option 3: Stream arbitrary Godot-packed scene resources, write a verifier and then parse

Creating a JSON schema for arbitrary Godot-packed scene resources that have been converted to JSON is a complex task. This option might be more challenging than adapting glTF for use in sandbox C++. If our validation code is robust, we should never encounter a MissingNode. Verification acts like pattern matching, whereas implementing a data format involves data transformation.

## The Benefits

A significant benefit of these approaches is the ability to enforce specific requirements, such as the use of both PCVR and mobile image textures through formats like basis, BPTC, and ASTC during upload and download. Additionally, by controlling the instantiation process, we can prevent loading when, for example, an avatar exceeds a polycount of 100,000 triangles. This allows us to size worlds according to predefined constraints, with various optimization settings available.

## The Downsides

The primary downside is the complexity and potential performance impact of these security measures. Each option requires substantial development effort and may introduce latency or processing overhead. Furthermore, maintaining these systems as Godot evolves could lead to increased long-term maintenance costs.

## The Road Not Taken

We could have explored simpler, less secure methods of content distribution that rely more heavily on post-load validation rather than stringent pre-load checks.

## The Infrequent Use Case

These methods are designed to handle extremely large or complex scenes that might exceed even the proposed limits, as well as very rare resource types not covered by standard validators.

## In Core and Done by Us

We will maintain the core functionality of the sandbox and basic loaders, ensuring that any critical updates or security patches can be applied swiftly and uniformly.

## Status

Status: Proposed <!-- Draft | Proposed | Rejected | Accepted | Deprecated | Superseded by -->

## Decision Makers

- V-Sekai development team
- Fire
- Lyuma

## Tags

- V-Sekai

## Further Reading

1. [V-Sekai Â· GitHub](https://github.com/v-sekai) - Official GitHub account for the V-Sekai development community focusing on social VR functionality for the Godot Engine.
2. [V-Sekai/v-sekai-game](https://github.com/v-sekai/v-sekai-game) - This GitHub page hosts the V-Sekai open-source project, which integrates social VR/VRSNS/metaverse components into the Godot Engine.
