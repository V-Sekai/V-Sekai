# Draft: The Wandering Bakery - Prototype

## The Context

We need a way to test if LLMs can create engaging narratives in games. This prototype will serve as a testbed for exploring the potential of LLM-driven dynamic storytelling within a simplified game environment, focusing on how players can influence the narrative through their actions and choices within a baking-themed world.

## The Problem Statement

Traditional game stories are often static and predictable, limiting player agency and immersion. LLMs offer the potential to generate dynamic narratives that react to player choices and create emergent gameplay experiences.

## Describe how your proposal will work

The Minimal Viable Product (MVP) will focus on a single core gameplay loop centered around a traveling bakery. Each day, the player will arrive in a new procedurally generated village with a few key characters. These characters will have simple desires and backstories that can be discovered through dialogue and fulfilled with baked goods.

The core gameplay loop involves:

1. **Exploration:** Arriving in a new village and exploring its map, which includes key locations like a town square, a well, or a character's home.
2. **Dialogue:** Engaging in conversations with characters to uncover their needs, desires, and backstories. This dialogue will be dynamically generated by the LLM, responding to player choices and previous interactions.
3. **Baking:** Utilizing a recipe book and available ingredients to bake pastries with specific emotional connections (e.g., a comforting cookie, a celebratory cake). This includes managing a simple inventory and potentially purchasing ingredients.
4. **Observation:** Delivering pastries to characters and observing their reactions, which can range from simple dialogue changes to triggering new quests or story events. These reactions will be influenced by the type of pastry, the character's personality, and the overall narrative context generated by the LLM.

**LLM Integration:**

An AI Storyteller, powered by an LLM, will dynamically generate the following:

- **World Generation:** Creating a unique village each day with a simple map and a few key locations. Each village will have its own distinct atmosphere and characteristics, influencing the types of characters and their needs.
- **Character Development:** Generating characters with basic backstories, needs, and desires. This includes a daily "special customer" with a unique and more complex need that presents a greater challenge for the player.
- **Dynamic Dialogue:** Creating branching conversations that respond to player choices and actions, including variations based on gifted pastries and the character's emotional state.
- **Menu Generation:** Creating a menu with dynamic pricing based on ingredient scarcity and village economy. This adds an element of resource management and strategic decision-making to the gameplay.

**Content Verification:**

A verifier will monitor and filter LLM output to ensure quality and consistency. This includes:

- Ensuring coherence within the game's context.
- Filtering inappropriate or offensive content.
- Maintaining a consistent tone and style.

**Goal-Task Planner Integration (GTPyhop Style):**

To structure the narrative and guide the LLM, we'll integrate a Goal-Task Planner based on the GTPyhop framework.

- **Define predicates:**
  - `at(item, location)`: Specifies the location of an item (character, ingredient, pastry).
  - `has(character, item)`: Indicates a character possesses a specific item.
  - `wants(character, pastry)`: Specifies the pastry a character desires.
  - `knows_recipe(recipe)`: Indicates if the player knows a specific recipe.
  - `emotion(character, emotion_type)`: Describes the emotional state of a character.
- **Define operators:**
  - `move_to(location)`: Moves the player to a specific location.
  - `talk_to(character)`: Engages in dialogue with a character.
  - `bake_pastry(pastry_type)`: Bakes a pastry.
  - `give_pastry(character, pastry_type)`: Gives a pastry to a character.
  - `buy_ingredients(ingredient_type, amount)`: Purchases ingredients.
- **Define methods:**
  - `satisfy_character(character)`: A method to fulfill a character's pastry need.
  - `obtain_ingredients(ingredient_type, amount)`: A method to acquire ingredients.
  - `learn_recipe(recipe)`: A method to unlock a new recipe.
- **State representation:** The game state is a dictionary that tracks character locations, possessions, desires, known recipes, emotions, and available ingredients.

**Example Goal:**

- `satisfied(villager1)`

**Example in (pseudo) GTPyhop style:**

```python
# ... (other code) ...

def satisfy_character(state, character):
    if wants(state, character, pastry_type):
        if has(state, player, pastry_type):
            return [('give_pastry', character, pastry_type)]
        else:
            return [('bake_pastry', pastry_type), ('give_pastry', character, pastry_type)]
    return False

gtpyhop.declare_unigoal_methods('satisfied', satisfy_character)

# ... (other code) ...
```

## The Benefits

This prototype allows for rapid iteration and testing of LLM-driven narrative generation in a contained environment. It demonstrates the potential for dynamic storytelling and emergent gameplay, while the integration of GTPyhop provides a structured framework for planning and achieving goals within the narrative.

## The Downsides

The prototype will have a limited scope. LLM behavior can be unpredictable, requiring close monitoring.

## The Road Not Taken

A full-fledged game is too complex for an initial prototype. Starting with a simpler, focused experience allows for faster iteration and learning.

## Why is it in Core and done by us?

This aligns with our focus on innovative game development and exploring the use of LLMs in interactive narratives. It requires deep integration with our game engine and understanding of our long-term goals.

## Status

Status: Draft

## Decision Makers

The V-Sekai development team.

## Tags

V-Sekai, LLM, Prototype, Procedural Generation, Dynamic Narrative, GTPyhop, Baking.

## References

- [NousResearch Hermes-2-Pro-Mistral-7B](https://huggingface.co/NousResearch/Hermes-2-Pro-Mistral-7B)
- [V-Sekai Godot Task Goal Planner](https://github.com/V-Sekai/godot-task-goal-planner)
- [LLMs Canâ€™t Plan, But Can Help Planning in LLM-Modulo Frameworks](https://arxiv.org/html/2402.01817v2)

AI assistant Aria assisted with this article.

## Quote

"Make art. Doesn't matter if it is great or shit. Tell your story." - Member of the Seattle Blender User Group
